<!-- atrapa-lengua-game.component.html -->

<div class="game-container">
  <!-- Header del juego -->
  <header class="game-header">
    <div class="header-content">
      <button class="btn-back" (click)="volverAJuegos()">
        <span class="back-icon">←</span>
        <span>Volver</span>
      </button>
      
      <div class="game-info">
        <h1>👅 Atrapa la Lengua</h1>
        <p>Haz clic rápido cuando aparezcan las lenguas en pantalla</p>
      </div>
      
      <div class="game-stats" *ngIf="faseJuego === 'jugando'">
        <div class="stat">
          <span class="stat-label">Nivel</span>
          <span class="stat-value">{{ nivelActual }}/{{ maxNiveles }}</span>
        </div>
        <div class="stat">
          <span class="stat-label">Vidas</span>
          <span class="stat-value">
            <span *ngFor="let vida of [1,2,3]; let i = index" 
                  class="vida-icon"
                  [class.perdida]="i >= vidas">❤️</span>
          </span>
        </div>
        <div class="stat">
          <span class="stat-label">Combo</span>
          <span class="stat-value">{{ combo }}x</span>
        </div>
        <div class="stat">
          <span class="stat-label">Tiempo</span>
          <span class="stat-value">{{ formatearTiempo(getTiempoRestante()) }}</span>
        </div>
        <div class="stat">
          <span class="stat-label">Puntaje</span>
          <span class="stat-value">{{ puntaje }}</span>
        </div>
      </div>
    </div>
  </header>

  <!-- Pantalla de instrucciones -->
  <main class="game-main" *ngIf="faseJuego === 'instrucciones'">
    <div class="instructions-screen">
      <div class="instructions-card">
        <div class="instructions-header">
          <h2>👅 Cómo Jugar</h2>
          <div class="difficulty-badge">Reacción</div>
        </div>
        
        <div class="instructions-content">
          <div class="step">
            <div class="step-number">1</div>
            <div class="step-text">
              <strong>Observa atentamente</strong>
              <p>Las lenguas aparecerán en diferentes posiciones de la pantalla</p>
            </div>
          </div>
          
          <div class="step">
            <div class="step-number">2</div>
            <div class="step-text">
              <strong>Haz clic rápido</strong>
              <p>Cuando veas una lengua, haz clic encima lo más rápido posible</p>
            </div>
          </div>
          
          <div class="step">
            <div class="step-number">3</div>
            <div class="step-text">
              <strong>Mantén el combo</strong>
              <p>Atrapa lenguas consecutivas para multiplicar tu puntaje</p>
            </div>
          </div>
        </div>
        
        <div class="types-section">
          <h3>👅 Tipos de Lenguas</h3>
          <div class="types-grid">
            <div class="type-item normal">
              <span class="type-emoji">👅</span>
              <span class="type-name">Normal</span>
              <span class="type-points">50 pts</span>
            </div>
            <div class="type-item especial">
              <span class="type-emoji">👅</span>
              <span class="type-name">Especial</span>
              <span class="type-points">75 pts</span>
            </div>
            <div class="type-item bonus">
              <span class="type-emoji">👅</span>
              <span class="type-name">Bonus</span>
              <span class="type-points">100 pts</span>
            </div>
          </div>
        </div>
        
        <button class="btn-start" (click)="saltarInstrucciones()">
          ⚡ ¡Empezar a Jugar!
        </button>
      </div>
    </div>
  </main>

  <!-- Pantalla de preparación/countdown -->
  <main class="game-main" *ngIf="faseJuego === 'preparando'">
    <div class="preparing-screen">
      <div class="countdown-display">
        <h2>Nivel {{ nivelActual }}</h2>
        <p>Objetivo: {{ objetivoLenguas }} lenguas</p>
        <div class="countdown-circle">
          <span class="countdown-text">¡Prepárate!</span>
        </div>
      </div>
    </div>
  </main>

  <!-- Área principal del juego -->
  <main class="game-main" *ngIf="faseJuego === 'jugando'">
    <!-- Progreso del nivel -->
    <div class="level-progress">
      <div class="progress-header">
        <span class="progress-text">Progreso: {{ lenguasCapturadas }}/{{ objetivoLenguas }}</span>
        <div class="progress-bar-container">
          <div class="progress-bar" [style.width.%]="getProgreso()"></div>
        </div>
      </div>
    </div>

    <!-- Área de juego donde aparecen las lenguas -->
    <div class="game-area">
      <!-- Lenguas generadas dinámicamente -->
      <div *ngFor="let lengua of lenguas" 
           class="lengua-target"
           [class.visible]="lengua.visible"
           [class.capturada]="lengua.capturada"
           [ngClass]="'tipo-' + lengua.tipo"
           [style.left.px]="lengua.x"
           [style.top.px]="lengua.y"
           (click)="capturarLengua(lengua, $event)">
        
        <div class="lengua-emoji" 
             [class.pulsando]="lengua.visible && !lengua.capturada">
          👅
        </div>
        
        <!-- Indicador de tiempo restante -->
        <div class="lengua-timer" 
             [style.animation-duration.ms]="lengua.tiempoVida">
        </div>
      </div>

      <!-- Efectos visuales de captura -->
      <div *ngFor="let efecto of efectosVisuales" 
           class="efecto-captura"
           [style.left.px]="efecto.x"
           [style.top.px]="efecto.y"
           [ngClass]="'efecto-' + efecto.tipo">
        <div class="efecto-puntos">+{{ efecto.puntos }}</div>
        <div class="efecto-particulas">✨</div>
      </div>
    </div>

    <!-- Información en tiempo real -->
    <div class="game-info-panel">
      <div class="info-item">
        <span class="info-icon">🎯</span>
        <span class="info-text">{{ lenguasCapturadas }}/{{ objetivoLenguas }}</span>
      </div>
      
      <div class="info-item combo-display" *ngIf="combo > 1">
        <span class="info-icon">🔥</span>
        <span class="info-text">Combo x{{ combo }}</span>
      </div>
      
      <div class="info-item tiempo-display">
        <span class="info-icon">⏱️</span>
        <span class="info-text">{{ formatearTiempo(getTiempoRestante()) }}</span>
      </div>
    </div>
  </main>

  <!-- Modal de juego completado -->
  <div class="completion-modal" *ngIf="faseJuego === 'completado'">
    <div class="modal-content">
      <div class="celebration" *ngIf="vidas > 0 && nivelActual >= maxNiveles">
        <div class="celebration-emoji">🏆</div>
        <h2>¡Reflejos increíbles!</h2>
        <p>Has completado todos los niveles de Atrapa la Lengua</p>
      </div>
      
      <div class="celebration" *ngIf="vidas > 0 && nivelActual < maxNiveles">
        <div class="celebration-emoji">⚡</div>
        <h2>¡Nivel superado!</h2>
        <p>Excelentes reflejos. Continuemos al siguiente nivel.</p>
      </div>
      
      <div class="celebration" *ngIf="vidas <= 0">
        <div class="celebration-emoji">💪</div>
        <h2>¡Buen intento!</h2>
        <p>Llegaste al nivel {{ nivelActual }}. ¡Sigue practicando tus reflejos!</p>
      </div>
      
      <div class="final-stats">
        <div class="stat-final">
          <span class="stat-icon">🎯</span>
          <span class="stat-text">Nivel alcanzado: {{ nivelActual }}/{{ maxNiveles }}</span>
        </div>
        <div class="stat-final">
          <span class="stat-icon">👅</span>
          <span class="stat-text">Lenguas capturadas: {{ lenguasCapturadas }}</span>
        </div>
        <div class="stat-final">
          <span class="stat-icon">🔥</span>
          <span class="stat-text">Combo máximo: {{ maxCombo }}x</span>
        </div>
        <div class="stat-final">
          <span class="stat-icon">❤️</span>
          <span class="stat-text">Vidas restantes: {{ vidas }}</span>
        </div>
        <div class="stat-final">
          <span class="stat-icon">⏱️</span>
          <span class="stat-text">Tiempo: {{ formatearTiempo(tiempoTranscurrido) }}</span>
        </div>
        <div class="stat-final">
          <span class="stat-icon">⭐</span>
          <span class="stat-text">Puntaje: {{ puntaje }}</span>
        </div>
      </div>
      
      <div class="stars-rating" *ngIf="vidas > 0">
        <span *ngFor="let star of [1,2,3]; let i = index" 
              class="star"
              [class.filled]="i < getEstrellas()">
          ⭐
        </span>
      </div>
      
      <div class="modal-actions">
        <button class="btn-secondary" (click)="reiniciarJuego()">
          🔄 Jugar de Nuevo
        </button>
        
        <button class="btn-primary" (click)="siguienteJuego()">
          ➡️ Siguiente Juego
        </button>
        
        <button class="btn-outline" (click)="volverAJuegos()">
          🏠 Volver a Juegos
        </button>
      </div>
    </div>
  </div>

  <!-- Overlay del modal -->
  <div class="modal-overlay" *ngIf="faseJuego === 'completado'" (click)="volverAJuegos()"></div>
</div>