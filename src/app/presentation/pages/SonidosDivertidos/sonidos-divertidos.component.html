<div class="game-container">
  <!-- Header con tÃ­tulo y progreso -->
  <div class="game-header">
    <button class="btn-back" (click)="volverAlMenu()">
      <span class="icon">â†</span> Volver
    </button>
    <h1 class="game-title">ğŸµ Sonidos Divertidos ğŸµ</h1>
    <div class="progress-info">
      <span class="sonidos-restantes">{{ sonidosRestantes }} sonidos mÃ¡s</span>
    </div>
  </div>

  <!-- Barra de progreso -->
  <div class="progress-bar-container">
    <div class="progress-bar" [style.width.%]="progreso"></div>
  </div>

  <!-- Contenido del juego -->
  <div class="game-content" *ngIf="!juegoCompletado && sonidoActual">
    
    <!-- Video con filtro AR -->
    <div class="camera-section">
      <div class="camera-container" *ngIf="camaraActiva">
        <div class="camera-wrapper">
          <!-- Video oculto (fuente) -->
          <video #videoElement autoplay playsinline muted class="video-hidden"></video>
          
          <!-- Canvas visible con filtro -->
          <canvas #canvasElement class="video-canvas"></canvas>
          
          <!-- Overlay con info del animal -->
          <div class="camera-overlay">
            <div class="animal-info">
              <h2 class="animal-nombre">{{ sonidoActual.nombre }}</h2>
            </div>
          </div>

          <!-- Estado del micrÃ³fono -->
          <div class="mic-status" *ngIf="escuchandoAhora">
            <div class="mic-indicator">
              <span class="mic-icon">ğŸ¤</span>
              <span class="mic-text">Escuchando...</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Error de cÃ¡mara -->
      <div class="camera-error" *ngIf="camaraError && !camaraActiva">
        <div class="error-box">
          <span class="error-icon">ğŸ“¹</span>
          <p class="error-message">{{ camaraError }}</p>
          <button class="btn-reintentar" (click)="iniciarCamara()">
            ğŸ”„ Reintentar
          </button>
        </div>
      </div>

      <!-- Cargando cÃ¡mara -->
      <div class="camera-loading" *ngIf="!camaraActiva && !camaraError">
        <div class="loading-spinner"></div>
        <p>Iniciando cÃ¡mara...</p>
      </div>
    </div>

    <!-- Tarjeta de informaciÃ³n -->
    <div class="sonido-card">
      <!-- Emoji grande del sonido -->
      <div class="sonido-emoji-large">
        {{ sonidoActual.imagen }}
      </div>

      <!-- Instrucciones claras -->
      <div class="instrucciones-box">
        <p class="instruccion-principal">ğŸ‘„ Â¡Di el sonido que hace!</p>
      </div>

      <!-- Onomatopeya -->
      <div class="onomatopeya-container">
        <p class="onomatopeya">{{ sonidoActual.onomatopeya }}</p>
      </div>

      <!-- TranscripciÃ³n en tiempo real -->
      <div class="transcripcion-box" *ngIf="transcripcion">
        <p class="transcripcion-label">EscuchÃ©:</p>
        <p class="transcripcion-text">"{{ transcripcion }}"</p>
      </div>

      <!-- Feedback de la respuesta -->
      <div class="feedback-container" *ngIf="mostrarFeedback">
        <div class="feedback-box" [ngClass]="feedbackTipo">
          <span class="feedback-icon" *ngIf="feedbackTipo === 'correcto'">âœ…</span>
          <span class="feedback-icon" *ngIf="feedbackTipo === 'incorrecto'">âŒ</span>
          <p class="feedback-mensaje">{{ feedbackMensaje }}</p>
        </div>
      </div>

      <!-- Botones de acciÃ³n -->
      <div class="action-buttons">
        <button class="btn-escuchar" (click)="reproducirSonido()" [disabled]="escuchandoAhora">
          <span class="icon">ğŸ”Š</span>
          Escuchar
        </button>
        
        <button 
          class="btn-grabar" 
          (click)="iniciarDeteccion()" 
          [disabled]="escuchandoAhora || !reconocimientoDisponible"
          [ngClass]="{'grabando': escuchandoAhora}">
          <span class="icon">ğŸ¤</span>
          <span *ngIf="!escuchandoAhora">Grabar mi voz</span>
          <span *ngIf="escuchandoAhora">Escuchando...</span>
        </button>
        
        <button class="btn-saltar" (click)="saltarSonido()" *ngIf="intentoActual >= 2">
          <span class="icon">â­ï¸</span>
          Saltar
        </button>
      </div>

      <!-- Advertencia si no hay reconocimiento de voz -->
      <div class="warning-box" *ngIf="!reconocimientoDisponible">
        <p>âš ï¸ Reconocimiento de voz no disponible. Usa Chrome o Edge.</p>
      </div>

      <!-- Intentos -->
      <div class="intentos-info" *ngIf="intentoActual > 0">
        <p>Intento {{ intentoActual }} de {{ maxIntentos }}</p>
      </div>
    </div>
  </div>

  <!-- CelebraciÃ³n entre sonidos -->
  <div class="celebracion-overlay" *ngIf="mostrarCelebracion && !juegoCompletado">
    <div class="celebracion-content">
      <div class="celebracion-emoji">ğŸ‰</div>
      <h2>Â¡Muy bien!</h2>
      <p>Â¡Excelente sonido!</p>
    </div>
  </div>

  <!-- Pantalla de juego completado -->
  <div class="game-completed" *ngIf="juegoCompletado">
    <div class="completion-card">
      <div class="completion-emoji">ğŸ†</div>
      <h2>Â¡Felicitaciones!</h2>
      <p class="completion-message">
        Â¡Completaste todos los sonidos divertidos!
      </p>
      <p class="completion-submessage">
        Â¡Hiciste un trabajo increÃ­ble! ğŸŒŸ
      </p>
      <div class="completion-buttons">
        <button class="btn-reiniciar" (click)="reiniciarJuego()">
          <span class="icon">ğŸ”„</span>
          Jugar de nuevo
        </button>
        <button class="btn-menu" (click)="volverAlMenu()">
          <span class="icon">ğŸ </span>
          MenÃº principal
        </button>
      </div>
    </div>
  </div>
</div>