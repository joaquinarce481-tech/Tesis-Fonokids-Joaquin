<div class="ruleta-container">
  <div class="header">
    <div class="score-badge">
      <span class="score-icon">â­</span>
      <span class="score-value">{{puntos}} puntos</span>
    </div>
  </div>

  <div class="game-wrapper">
    
    <div class="wheel-section">
      <div class="arrow-indicator"></div>
      
      <svg width="360" height="360" viewBox="0 0 360 360" class="ruleta-svg"
        [style.transform]="'rotate(' + rotation + 'deg)'"
        [class.spinning]="isSpinning">
        
        <!-- BESO: 0Â° a 72Â° (Derecha) -->
        <path d="M 180 180 L 330 180 A 150 150 0 0 1 226.42 313.58 Z" fill="#FF6B6B" stroke="#fff" stroke-width="5"/>
        <text x="255" y="235" font-size="35" text-anchor="middle">ğŸ˜—</text>
        <text x="255" y="205" font-size="12" font-weight="bold" fill="#fff" text-anchor="middle">BESO</text>
        
        <!-- CACHETES: 72Â° a 144Â° (Abajo derecha) -->
        <path d="M 180 180 L 226.42 313.58 A 150 150 0 0 1 46.42 226.42 Z" fill="#4ECDC4" stroke="#fff" stroke-width="5"/>
        <text x="150" y="275" font-size="35" text-anchor="middle">ğŸ˜®</text>
        <text x="150" y="245" font-size="11" font-weight="bold" fill="#fff" text-anchor="middle">CACHETES</text>
        
        <!-- LENGUA: 144Â° a 216Â° (Izquierda) -->
        <path d="M 180 180 L 46.42 226.42 A 150 150 0 0 1 46.42 133.58 Z" fill="#45B7D1" stroke="#fff" stroke-width="5"/>
        <text x="80" y="190" font-size="35" text-anchor="middle">ğŸ˜›</text>
        <text x="80" y="160" font-size="12" font-weight="bold" fill="#fff" text-anchor="middle">LENGUA</text>
        
        <!-- SONRISA: 216Â° a 288Â° (Arriba izquierda) -->
        <path d="M 180 180 L 46.42 133.58 A 150 150 0 0 1 226.42 46.42 Z" fill="#96CEB4" stroke="#fff" stroke-width="5"/>
        <text x="150" y="105" font-size="35" text-anchor="middle">ğŸ˜„</text>
        <text x="150" y="135" font-size="11" font-weight="bold" fill="#fff" text-anchor="middle">SONRISA</text>
        
        <!-- SOPLAR: 288Â° a 360Â° (Arriba derecha) -->
        <path d="M 180 180 L 226.42 46.42 A 150 150 0 0 1 330 180 Z" fill="#FF9FF3" stroke="#fff" stroke-width="5"/>
        <text x="255" y="125" font-size="35" text-anchor="middle">ğŸ’¨</text>
        <text x="255" y="155" font-size="12" font-weight="bold" fill="#fff" text-anchor="middle">SOPLAR</text>
        
        <!-- Borde exterior -->
        <circle cx="180" cy="180" r="150" fill="none" stroke="#fff" stroke-width="6"/>
        
        <!-- Centro -->
        <circle cx="180" cy="180" r="50" fill="#FFD93D" stroke="#fff" stroke-width="5"/>
        <text x="180" y="190" text-anchor="middle" font-size="18" font-weight="bold" fill="#333">GIRA</text>
      </svg>
      
      <div class="button-row">
        <button class="btn-spin" [disabled]="isSpinning" (click)="spinWheel()">
          ğŸ² {{isSpinning ? 'Â¡GIRANDO!' : 'Â¡GIRAR AHORA!'}}
        </button>
        <button class="btn-reset" (click)="resetRuleta()">
          ğŸ”„ REINICIAR
        </button>
      </div>
    </div>

    <div class="side-panel">
      
      <!-- Pantalla de instrucciones -->
      <div *ngIf="showInstructions && selectedPraxia && !isCameraActive && !isExerciseCorrect" class="praxia-display">
        <div class="big-emoji">{{selectedPraxia?.emoji}}</div>
        <h2 class="praxia-title">{{selectedPraxia?.nombre}}</h2>
        <div class="difficulty-stars">â˜…â˜…â˜…â˜†â˜†</div>
      </div>

      <div *ngIf="showInstructions && selectedPraxia && !isCameraActive && !isExerciseCorrect" class="instruction-panel">
        <div class="instruction-header">
          <span class="icon">ğŸ“‹</span>
          <h3>Â¿CÃ³mo hacerlo?</h3>
        </div>
        <p class="instruction-text">{{selectedPraxia?.instruccion}}</p>
        
        <div class="info-cards">
          <div class="info-card">
            <div class="info-icon">â±ï¸</div>
            <div class="info-content">
              <span class="info-label">DURACIÃ“N</span>
              <span class="info-value">{{selectedPraxia?.duracion}}</span>
            </div>
          </div>
          <div class="info-card">
            <div class="info-icon">ğŸ”„</div>
            <div class="info-content">
              <span class="info-label">REPETICIONES</span>
              <span class="info-value">{{selectedPraxia?.repeticiones}}x</span>
            </div>
          </div>
        </div>
        
        <button class="btn-start" (click)="startCamera()">
          ğŸ“¹ Â¡COMENZAR DESAFÃO!
        </button>
      </div>

      <!-- Panel de cÃ¡mara activa -->
      <div *ngIf="isCameraActive && !isExerciseCorrect" class="camera-panel">
        <div class="camera-header">
          <h3>{{selectedPraxia?.nombre}}</h3>
          <button class="btn-close" (click)="stopCamera()">âœ•</button>
        </div>
        
        <div class="video-wrapper">
          <video #videoElement autoplay muted playsinline class="video-feed"></video>
          <canvas #canvasElement class="canvas-overlay"></canvas>
          
          <div class="progress-indicator">
            <div class="progress-ring">
              <svg width="90" height="90">
                <circle cx="45" cy="45" r="35" stroke="#ddd" stroke-width="6" fill="none"></circle>
                <circle cx="45" cy="45" r="35" stroke="#4CAF50" stroke-width="6" fill="none"
                  [style.stroke-dasharray]="2 * Math.PI * 35"
                  [style.stroke-dashoffset]="2 * Math.PI * 35 * (1 - exerciseProgress / 100)"
                  class="progress-fill"></circle>
              </svg>
              <div class="progress-percent">{{exerciseProgress.toFixed(0)}}%</div>
            </div>
            <div class="detection-badge" [class.active]="detectionScore > 70">
              PrecisiÃ³n: {{detectionScore.toFixed(0)}}%
            </div>
          </div>
        </div>
        
        <div class="camera-status">
          <p *ngIf="!stream">ğŸ”´ Activando cÃ¡mara...</p>
          <p *ngIf="stream && !isDetecting">ğŸ“¹ CÃ¡mara lista</p>
          <p *ngIf="isDetecting">ğŸ¤– IA detectando...</p>
        </div>
        
        <div class="feedback-box">
          <div *ngIf="detectionScore > 80" class="feedback success">Â¡PERFECTO!</div>
          <div *ngIf="detectionScore > 50 && detectionScore <= 80" class="feedback good">Â¡Muy bien!</div>
          <div *ngIf="detectionScore <= 50 && detectionScore > 0" class="feedback try">Â¡IntÃ©ntalo!</div>
        </div>
      </div>

      <!-- Pantalla de Ã©xito -->
      <div *ngIf="isExerciseCorrect" class="success-box">
        <div class="success-emoji">ğŸ‰</div>
        <h2>Â¡INCREÃBLE!</h2>
        <p>Â¡Completaste el ejercicio!</p>
        <div class="points-badge">+20 puntos</div>
      </div>

      <!-- Pantalla de espera inicial -->
      <div *ngIf="!showInstructions && !isCameraActive && !isExerciseCorrect" class="waiting-box">
        <div class="waiting-dice">ğŸ²</div>
        <h3>Â¡Hora de Jugar!</h3>
        <p>Presiona <strong>"Â¡GIRAR AHORA!"</strong> para comenzar</p>
        <div class="tip">
          <span>ğŸ’¡</span>
          <span>La IA detectarÃ¡ tus movimientos</span>
        </div>
      </div>
      
    </div>
  </div>

  <!-- Confeti de celebraciÃ³n -->
  <div *ngIf="isExerciseCorrect" class="confetti">
    <div *ngFor="let item of [0,1,2,3,4,5,6,7,8,9]" 
         class="confetti-piece"
         [style.left.%]="getConfettiLeft(item)"
         [style.animation-delay.s]="getConfettiDelay(item)"></div>
  </div>
</div>