<div class="ruleta-container">
  <div class="header">
    <div class="score-badge">
      <span class="score-icon">⭐</span>
      <span class="score-value">{{puntos}} puntos</span>
    </div>
  </div>

  <div class="game-wrapper">
    
    <div class="wheel-section">
      <div class="arrow-indicator"></div>
      
      <svg width="360" height="360" viewBox="0 0 360 360" class="ruleta-svg"
        [style.transform]="'rotate(' + rotation + 'deg)'"
        [class.spinning]="isSpinning">
        
        <!-- BESO: 0° a 72° (Derecha) -->
        <path d="M 180 180 L 330 180 A 150 150 0 0 1 226.42 313.58 Z" fill="#FF6B6B" stroke="#fff" stroke-width="5"/>
        <text x="255" y="235" font-size="35" text-anchor="middle">😗</text>
        <text x="255" y="205" font-size="12" font-weight="bold" fill="#fff" text-anchor="middle">BESO</text>
        
        <!-- CACHETES: 72° a 144° (Abajo derecha) -->
        <path d="M 180 180 L 226.42 313.58 A 150 150 0 0 1 46.42 226.42 Z" fill="#4ECDC4" stroke="#fff" stroke-width="5"/>
        <text x="150" y="275" font-size="35" text-anchor="middle">😮</text>
        <text x="150" y="245" font-size="11" font-weight="bold" fill="#fff" text-anchor="middle">CACHETES</text>
        
        <!-- LENGUA: 144° a 216° (Izquierda) -->
        <path d="M 180 180 L 46.42 226.42 A 150 150 0 0 1 46.42 133.58 Z" fill="#45B7D1" stroke="#fff" stroke-width="5"/>
        <text x="80" y="190" font-size="35" text-anchor="middle">😛</text>
        <text x="80" y="160" font-size="12" font-weight="bold" fill="#fff" text-anchor="middle">LENGUA</text>
        
        <!-- SONRISA: 216° a 288° (Arriba izquierda) -->
        <path d="M 180 180 L 46.42 133.58 A 150 150 0 0 1 226.42 46.42 Z" fill="#96CEB4" stroke="#fff" stroke-width="5"/>
        <text x="150" y="105" font-size="35" text-anchor="middle">😄</text>
        <text x="150" y="135" font-size="11" font-weight="bold" fill="#fff" text-anchor="middle">SONRISA</text>
        
        <!-- SOPLAR: 288° a 360° (Arriba derecha) -->
        <path d="M 180 180 L 226.42 46.42 A 150 150 0 0 1 330 180 Z" fill="#FF9FF3" stroke="#fff" stroke-width="5"/>
        <text x="255" y="125" font-size="35" text-anchor="middle">💨</text>
        <text x="255" y="155" font-size="12" font-weight="bold" fill="#fff" text-anchor="middle">SOPLAR</text>
        
        <!-- Borde exterior -->
        <circle cx="180" cy="180" r="150" fill="none" stroke="#fff" stroke-width="6"/>
        
        <!-- Centro -->
        <circle cx="180" cy="180" r="50" fill="#FFD93D" stroke="#fff" stroke-width="5"/>
        <text x="180" y="190" text-anchor="middle" font-size="18" font-weight="bold" fill="#333">GIRA</text>
      </svg>
      
      <div class="button-row">
        <button class="btn-spin" [disabled]="isSpinning" (click)="spinWheel()">
          🎲 {{isSpinning ? '¡GIRANDO!' : '¡GIRAR AHORA!'}}
        </button>
        <button class="btn-reset" (click)="resetRuleta()">
          🔄 REINICIAR
        </button>
      </div>
    </div>

    <div class="side-panel">
      
      <!-- Pantalla de instrucciones -->
      <div *ngIf="showInstructions && selectedPraxia && !isCameraActive && !isExerciseCorrect" class="praxia-display">
        <div class="big-emoji">{{selectedPraxia?.emoji}}</div>
        <h2 class="praxia-title">{{selectedPraxia?.nombre}}</h2>
        <div class="difficulty-stars">★★★☆☆</div>
      </div>

      <div *ngIf="showInstructions && selectedPraxia && !isCameraActive && !isExerciseCorrect" class="instruction-panel">
        <div class="instruction-header">
          <span class="icon">📋</span>
          <h3>¿Cómo hacerlo?</h3>
        </div>
        <p class="instruction-text">{{selectedPraxia?.instruccion}}</p>
        
        <div class="info-cards">
          <div class="info-card">
            <div class="info-icon">⏱️</div>
            <div class="info-content">
              <span class="info-label">DURACIÓN</span>
              <span class="info-value">{{selectedPraxia?.duracion}}</span>
            </div>
          </div>
          <div class="info-card">
            <div class="info-icon">🔄</div>
            <div class="info-content">
              <span class="info-label">REPETICIONES</span>
              <span class="info-value">{{selectedPraxia?.repeticiones}}x</span>
            </div>
          </div>
        </div>
        
        <button class="btn-start" (click)="startCamera()">
          📹 ¡COMENZAR DESAFÍO!
        </button>
      </div>

      <!-- Panel de cámara activa -->
      <div *ngIf="isCameraActive && !isExerciseCorrect" class="camera-panel">
        <div class="camera-header">
          <h3>{{selectedPraxia?.nombre}}</h3>
          <button class="btn-close" (click)="stopCamera()">✕</button>
        </div>
        
        <div class="video-wrapper">
          <video #videoElement autoplay muted playsinline class="video-feed"></video>
          <canvas #canvasElement class="canvas-overlay"></canvas>
          
          <div class="progress-indicator">
            <div class="progress-ring">
              <svg width="90" height="90">
                <circle cx="45" cy="45" r="35" stroke="#ddd" stroke-width="6" fill="none"></circle>
                <circle cx="45" cy="45" r="35" stroke="#4CAF50" stroke-width="6" fill="none"
                  [style.stroke-dasharray]="2 * Math.PI * 35"
                  [style.stroke-dashoffset]="2 * Math.PI * 35 * (1 - exerciseProgress / 100)"
                  class="progress-fill"></circle>
              </svg>
              <div class="progress-percent">{{exerciseProgress.toFixed(0)}}%</div>
            </div>
            <div class="detection-badge" [class.active]="detectionScore > 70">
              Precisión: {{detectionScore.toFixed(0)}}%
            </div>
          </div>
        </div>
        
        <div class="camera-status">
          <p *ngIf="!stream">🔴 Activando cámara...</p>
          <p *ngIf="stream && !isDetecting">📹 Cámara lista</p>
          <p *ngIf="isDetecting">🤖 IA detectando...</p>
        </div>
        
        <div class="feedback-box">
          <div *ngIf="detectionScore > 80" class="feedback success">¡PERFECTO!</div>
          <div *ngIf="detectionScore > 50 && detectionScore <= 80" class="feedback good">¡Muy bien!</div>
          <div *ngIf="detectionScore <= 50 && detectionScore > 0" class="feedback try">¡Inténtalo!</div>
        </div>
      </div>

      <!-- Pantalla de éxito -->
      <div *ngIf="isExerciseCorrect" class="success-box">
        <div class="success-emoji">🎉</div>
        <h2>¡INCREÍBLE!</h2>
        <p>¡Completaste el ejercicio!</p>
        <div class="points-badge">+20 puntos</div>
      </div>

      <!-- Pantalla de espera inicial -->
      <div *ngIf="!showInstructions && !isCameraActive && !isExerciseCorrect" class="waiting-box">
        <div class="waiting-dice">🎲</div>
        <h3>¡Hora de Jugar!</h3>
        <p>Presiona <strong>"¡GIRAR AHORA!"</strong> para comenzar</p>
        <div class="tip">
          <span>💡</span>
          <span>La IA detectará tus movimientos</span>
        </div>
      </div>
      
    </div>
  </div>

  <!-- Confeti de celebración -->
  <div *ngIf="isExerciseCorrect" class="confetti">
    <div *ngFor="let item of [0,1,2,3,4,5,6,7,8,9]" 
         class="confetti-piece"
         [style.left.%]="getConfettiLeft(item)"
         [style.animation-delay.s]="getConfettiDelay(item)"></div>
  </div>
</div>