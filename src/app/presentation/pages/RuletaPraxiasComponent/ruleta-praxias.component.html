<div class="ruleta-container">
  <!-- Header -->
  <div class="header">
    <h1 class="title">ğŸ¯ Ruleta de Praxias con IA</h1>
    <p class="subtitle">Â¡Gira la ruleta y demuestra que puedes hacer el ejercicio!</p>
    
    <!-- PuntuaciÃ³n -->
    <div class="score-container">
      <span class="score">â­ {{puntos}} puntos</span>
    </div>
  </div>

  <!-- Contenido principal -->
  <div class="main-content">
    
    <!-- Columna izquierda: Ruleta -->
    <div class="ruleta-column">
      <div class="ruleta-wrapper">
        <!-- Flecha indicadora -->
        <div class="arrow-indicator"></div>
        
        <!-- SVG Ruleta CORREGIDO -->
        <svg 
          width="320" 
          height="320" 
          viewBox="0 0 320 320" 
          class="ruleta-svg"
          [style.transform]="'rotate(' + rotation + 'deg)'"
          [class.spinning]="isSpinning">
          
          <!-- Segmento 1: Beso -->
          <path d="M 160 160 L 310 160 A 150 150 0 0 1 266.066 266.066 Z" fill="#FF6B6B" stroke="#fff" stroke-width="3"></path>
          <text x="238" y="213" text-anchor="middle" dominant-baseline="middle" font-size="24" transform="rotate(45, 238, 213)">ğŸ˜—</text>
          
          <!-- Segmento 2: Inflar Cachetes -->
          <path d="M 160 160 L 266.066 266.066 A 150 150 0 0 1 160 310 Z" fill="#4ECDC4" stroke="#fff" stroke-width="3"></path>
          <text x="213" y="266" text-anchor="middle" dominant-baseline="middle" font-size="24" transform="rotate(117, 213, 266)">ğŸ˜®</text>
          
          <!-- Segmento 3: Lengua Afuera -->
          <path d="M 160 160 L 160 310 A 150 150 0 0 1 53.934 266.066 Z" fill="#45B7D1" stroke="#fff" stroke-width="3"></path>
          <text x="107" y="266" text-anchor="middle" dominant-baseline="middle" font-size="24" transform="rotate(189, 107, 266)">ğŸ˜›</text>
          
          <!-- Segmento 4: Sonrisa Grande -->
          <path d="M 160 160 L 53.934 266.066 A 150 150 0 0 1 10 160 Z" fill="#96CEB4" stroke="#fff" stroke-width="3"></path>
          <text x="82" y="213" text-anchor="middle" dominant-baseline="middle" font-size="24" transform="rotate(261, 82, 213)">ğŸ˜„</text>
          
          <!-- Segmento 5: Soplar -->
          <path d="M 160 160 L 10 160 A 150 150 0 0 1 160 10 Z" fill="#FF9FF3" stroke="#fff" stroke-width="3"></path>
          <text x="110" y="85" text-anchor="middle" dominant-baseline="middle" font-size="24" transform="rotate(333, 110, 85)">ğŸ’¨</text>
          
          <!-- Centro de la ruleta -->
          <circle cx="160" cy="160" r="25" fill="#fff" stroke="#333" stroke-width="3"></circle>
          <text x="160" y="167" text-anchor="middle" font-size="12" font-weight="bold" fill="#333">
            GIRA
          </text>
        </svg>
      </div>

      <!-- Botones de control -->
      <div class="control-buttons">
        <button 
          class="spin-button"
          [disabled]="isSpinning"
          (click)="spinWheel()">
          {{isSpinning ? 'Girando...' : 'Â¡GIRAR!'}}
        </button>
        
        <button 
          class="reset-button"
          (click)="resetRuleta()">
          ğŸ”„ Reset
        </button>
      </div>
    </div>

    <!-- Columna derecha: Instrucciones y cÃ¡mara -->
    <div class="instructions-column">
      
      <!-- Panel de instrucciones -->
      <div *ngIf="showInstructions && selectedPraxia && !isCameraActive" class="instructions-panel">
        <div class="praxia-header">
          <div class="praxia-emoji">{{selectedPraxia?.emoji}}</div>
          <h2 class="praxia-name">{{selectedPraxia?.nombre}}</h2>
        </div>
        
        <div class="instruction-content">
          <div class="instruction-text">
            <h3>ğŸ“‹ Instrucciones:</h3>
            <p>{{selectedPraxia?.instruccion}}</p>
          </div>
          
          <div class="exercise-details">
            <div class="detail-box">
              <p class="detail-label">â±ï¸ DuraciÃ³n</p>
              <p class="detail-value">{{selectedPraxia?.duracion}}</p>
            </div>
            <div class="detail-box">
              <p class="detail-label">ğŸ”„ Repetir</p>
              <p class="detail-value">{{selectedPraxia?.repeticiones}} veces</p>
            </div>
          </div>
          
          <button 
            class="start-camera-button"
            (click)="startCamera()">
            ğŸ“¹ Â¡Empezar con cÃ¡mara!
          </button>
        </div>
      </div>

      <!-- Panel de cÃ¡mara activa CORREGIDO -->
      <div *ngIf="isCameraActive" class="camera-panel">
        <div class="camera-header">
          <h3>{{selectedPraxia?.nombre}} - Â¡Hazlo ahora!</h3>
          <button class="close-camera" (click)="stopCamera()">âŒ</button>
        </div>
        
        <!-- Video y canvas superpuestos -->
        <div class="video-container">
          <video 
            #videoElement
            autoplay 
            muted
            playsinline
            class="video-element">
          </video>
          <canvas 
            #canvasElement
            class="detection-overlay">
          </canvas>
          
          <!-- Overlay de progreso -->
          <div class="progress-overlay">
            <!-- Barra de progreso circular -->
            <div class="progress-circle">
              <svg width="100" height="100" class="progress-svg">
                <circle 
                  cx="50" 
                  cy="50" 
                  r="40" 
                  stroke="#e0e0e0" 
                  stroke-width="8" 
                  fill="none">
                </circle>
                <circle 
                  cx="50" 
                  cy="50" 
                  r="40" 
                  stroke="#4CAF50" 
                  stroke-width="8" 
                  fill="none"
                  [style.stroke-dasharray]="2 * Math.PI * 40"
                  [style.stroke-dashoffset]="2 * Math.PI * 40 * (1 - exerciseProgress / 100)"
                  class="progress-circle-fill">
                </circle>
              </svg>
              <div class="progress-text">{{exerciseProgress.toFixed(0)}}%</div>
            </div>
            
            <!-- Indicador de detecciÃ³n -->
            <div class="detection-indicator" [class.active]="detectionScore > 70">
              <div class="detection-score">
                PrecisiÃ³n: {{detectionScore.toFixed(0)}}%
              </div>
            </div>
          </div>
        </div>
        
        <!-- Estado de la cÃ¡mara AGREGADO -->
        <div class="camera-status">
          <p *ngIf="!stream">ğŸ”´ Activando cÃ¡mara...</p>
          <p *ngIf="stream && !isDetecting">ğŸ“¹ CÃ¡mara activa - Preparando detecciÃ³n...</p>
          <p *ngIf="isDetecting">ğŸ¤– IA detectando movimientos...</p>
        </div>
        
        <!-- Feedback del ejercicio -->
        <div class="exercise-feedback">
          <div *ngIf="detectionScore > 80" class="feedback success">
            ğŸ‰ Â¡PERFECTO! Â¡Sigue asÃ­!
          </div>
          <div *ngIf="detectionScore > 50 && detectionScore <= 80" class="feedback good">
            ğŸ‘ Â¡Muy bien! Un poquito mÃ¡s...
          </div>
          <div *ngIf="detectionScore <= 50" class="feedback try-again">
            ğŸ’ª Â¡IntÃ©ntalo! Mira el ejemplo
          </div>
        </div>
      </div>

      <!-- Panel de Ã©xito -->
      <div *ngIf="isExerciseCorrect" class="success-panel">
        <div class="success-animation">ğŸ‰</div>
        <h2>Â¡INCREÃBLE!</h2>
        <p>Â¡Completaste el ejercicio perfectamente!</p>
        <div class="points-earned">+20 puntos ganados</div>
      </div>

      <!-- Panel de espera -->
      <div *ngIf="!showInstructions && !isCameraActive && !isExerciseCorrect" class="waiting-panel">
        <div class="waiting-icon">ğŸ²</div>
        <h3>Â¡Gira la ruleta!</h3>
        <p>Haz clic en el botÃ³n "Â¡GIRAR!" para descubrir quÃ© praxia vas a practicar.</p>
      </div>
      
    </div>
  </div>

  <!-- Confetti de celebraciÃ³n -->
  <div *ngIf="isExerciseCorrect" class="confetti-container">
    <div 
      *ngFor="let item of [].constructor(20); let i = index"
      class="confetti-piece"
      [style.left.%]="Math.random() * 100"
      [style.animation-delay.s]="Math.random() * 2">
    </div>
  </div>
</div>