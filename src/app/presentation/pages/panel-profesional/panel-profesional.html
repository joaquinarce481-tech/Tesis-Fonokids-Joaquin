<div class="panel-container">
  <!-- Header del Panel -->
  <header class="panel-header">
    <div class="header-left">
      <button class="btn-volver" (click)="volverAlDashboard()">
        â† Volver
      </button>
      <div class="header-titulo">
        <h1>Panel Profesional</h1>
        <p>Seguimiento de pacientes</p>
      </div>
    </div>
    <div class="header-right" *ngIf="pacienteSeleccionado">
      <div class="paciente-info">
        <span class="paciente-icono">ğŸ‘¤</span>
        <span class="paciente-nombre">{{ pacienteSeleccionado.nombre_completo }}</span>
      </div>
    </div>
  </header>

  <!-- Estado de carga inicial -->
  <div class="loading-state" *ngIf="cargando">
    <div class="spinner"></div>
    <p>Cargando pacientes...</p>
  </div>

  <!-- Estado de error -->
  <div class="error-state" *ngIf="error && !cargando">
    <span class="error-icon">âš ï¸</span>
    <p>{{ error }}</p>
  </div>

  <!-- ========== LISTA DE PACIENTES ========== -->
  <main class="panel-content" *ngIf="!cargando && !error && !pacienteSeleccionado">
    <section class="lista-pacientes">
      <h2>Seleccionar Paciente</h2>
      <p class="subtitulo">Selecciona un paciente para ver su progreso</p>
      
      <div class="pacientes-grid" *ngIf="pacientes.length > 0">
        <div 
          class="paciente-card" 
          *ngFor="let paciente of pacientes"
          (click)="seleccionarPaciente(paciente)">
          <div class="paciente-avatar">
            {{ paciente.nombre_completo.charAt(0).toUpperCase() }}
          </div>
          <div class="paciente-datos">
            <h3>{{ paciente.nombre_completo }}</h3>
            <span class="paciente-username">@{{ paciente.username }}</span>
          </div>
          <span class="paciente-flecha">â†’</span>
        </div>
      </div>
      
      <div class="sin-datos" *ngIf="pacientes.length === 0">
        <span class="sin-datos-icono">ğŸ‘¥</span>
        <p>No hay pacientes registrados</p>
      </div>
    </section>
  </main>

  <!-- ========== HISTORIAL DEL PACIENTE SELECCIONADO ========== -->
  <div *ngIf="!cargando && !error && pacienteSeleccionado">
    
    <!-- NavegaciÃ³n de vistas -->
    <nav class="panel-nav">
      <button class="btn-volver-lista" (click)="volverALista()">
        â† Cambiar paciente
      </button>
      <div class="nav-tabs">
        <button 
          class="nav-btn" 
          [class.active]="vistaActual === 'resumen'"
          (click)="cambiarVista('resumen')">
          Resumen
        </button>
        <button 
          class="nav-btn" 
          [class.active]="vistaActual === 'historial'"
          (click)="cambiarVista('historial')">
          Historial
        </button>
      </div>
    </nav>

    <!-- Estado de carga del historial -->
    <div class="loading-state" *ngIf="cargandoHistorial">
      <div class="spinner"></div>
      <p>Cargando historial...</p>
    </div>

    <!-- Contenido Principal -->
    <main class="panel-content" *ngIf="!cargandoHistorial">
      
      <!-- VISTA RESUMEN -->
      <section class="vista-resumen" *ngIf="vistaActual === 'resumen'">
        
        <!-- Tarjetas de estadÃ­sticas -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icono ejercicios">ğŸ“‹</div>
            <div class="stat-info">
              <span class="stat-numero">{{ totalEjercicios }}</span>
              <span class="stat-label">Ejercicios realizados</span>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icono juegos">ğŸ®</div>
            <div class="stat-info">
              <span class="stat-numero">{{ totalJuegos }}</span>
              <span class="stat-label">Juegos completados</span>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icono total">ğŸ“Š</div>
            <div class="stat-info">
              <span class="stat-numero">{{ totalActividades }}</span>
              <span class="stat-label">Total actividades</span>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icono dias">ğŸ“…</div>
            <div class="stat-info">
              <span class="stat-numero">{{ diasActivos }}</span>
              <span class="stat-label">DÃ­as activos</span>
            </div>
          </div>
        </div>

        <!-- Info adicional -->
        <div class="info-adicional">
          <div class="info-item">
            <span class="info-label">Promedio por dÃ­a:</span>
            <span class="info-valor">{{ promedioPorDia }} actividades</span>
          </div>
          <div class="info-item">
            <span class="info-label">Ãšltima actividad:</span>
            <span class="info-valor">{{ ultimaActividad }}</span>
          </div>
        </div>

        <!-- Actividad reciente -->
        <div class="seccion-reciente">
          <h2>Actividad Reciente</h2>
          
          <div class="lista-dias" *ngIf="resumenPorDia.length > 0">
            <div 
              class="dia-card" 
              *ngFor="let dia of resumenPorDia.slice(0, 5)"
              (click)="verDetalleDia(dia)">
              <div class="dia-fecha">{{ dia.fechaFormateada }}</div>
              <div class="dia-stats">
                <span class="dia-stat">
                  <span class="stat-icon">ğŸ“‹</span> {{ dia.ejercicios }}
                </span>
                <span class="dia-stat">
                  <span class="stat-icon">ğŸ®</span> {{ dia.juegos }}
                </span>
                <span class="dia-total">Total: {{ dia.total }}</span>
              </div>
              <span class="dia-flecha">â†’</span>
            </div>
          </div>
          
          <div class="sin-datos" *ngIf="resumenPorDia.length === 0">
            <span class="sin-datos-icono">ğŸ“­</span>
            <p>No hay actividades registradas</p>
          </div>
        </div>
      </section>

      <!-- VISTA HISTORIAL -->
      <section class="vista-historial" *ngIf="vistaActual === 'historial'">
        <h2>Historial Completo</h2>
        
        <div class="historial-lista" *ngIf="resumenPorDia.length > 0">
          <div 
            class="historial-dia" 
            *ngFor="let dia of resumenPorDia"
            (click)="verDetalleDia(dia)">
            <div class="historial-fecha">
              <span class="fecha-texto">{{ dia.fechaFormateada }}</span>
              <span class="fecha-iso">{{ dia.fecha }}</span>
            </div>
            <div class="historial-resumen">
              <div class="resumen-item">
                <span class="resumen-num">{{ dia.ejercicios }}</span>
                <span class="resumen-label">ejercicios</span>
              </div>
              <div class="resumen-item">
                <span class="resumen-num">{{ dia.juegos }}</span>
                <span class="resumen-label">juegos</span>
              </div>
              <div class="resumen-item total">
                <span class="resumen-num">{{ dia.total }}</span>
                <span class="resumen-label">total</span>
              </div>
            </div>
            <span class="historial-flecha">â†’</span>
          </div>
        </div>
        
        <div class="sin-datos" *ngIf="resumenPorDia.length === 0">
          <span class="sin-datos-icono">ğŸ“­</span>
          <p>No hay historial disponible</p>
        </div>
      </section>

      <!-- VISTA DETALLE DÃA -->
      <section class="vista-detalle" *ngIf="vistaActual === 'detalle' && diaSeleccionado">
        <div class="detalle-header">
          <button class="btn-atras" (click)="cambiarVista('historial')">â† AtrÃ¡s</button>
          <h2>{{ diaSeleccionado.fechaFormateada }}</h2>
          <span class="detalle-fecha">{{ diaSeleccionado.fecha }}</span>
        </div>

        <div class="detalle-resumen">
          <span class="detalle-stat">ğŸ“‹ {{ diaSeleccionado.ejercicios }} ejercicios</span>
          <span class="detalle-stat">ğŸ® {{ diaSeleccionado.juegos }} juegos</span>
        </div>

        <div class="detalle-lista">
          <h3>Actividades del dÃ­a</h3>
          <div class="actividad-item" *ngFor="let act of diaSeleccionado.actividades">
            <span class="actividad-icono">{{ getIconoActividad(act.tipo_actividad) }}</span>
            <div class="actividad-info">
              <span class="actividad-nombre">{{ act.nombre_actividad }}</span>
              <span class="actividad-categoria">{{ act.tipo_actividad === 'juego_terapeutico' ? 'Juego TerapÃ©utico' : 'AnÃ¡lisis de PrÃ¡cticas' }}</span>
            </div>
            <span class="actividad-tipo" [class.juego]="act.tipo_actividad === 'juego_terapeutico'">
              {{ getTipoNombre(act.tipo_actividad) }}
            </span>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>