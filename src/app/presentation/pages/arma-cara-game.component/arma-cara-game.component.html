<div class="game-container">

  <!-- ========== PANTALLA DE INICIO ========== -->
  <div *ngIf="pantalla === 'inicio'" class="pantalla-inicio">
    <div class="contenido-inicio">
      
      <!-- Título principal -->
      <div class="titulo-principal">
        <h1 class="titulo-juego">🎭 Arma la Cara</h1>
        <p class="subtitulo-juego">Juego de Reconocimiento de Emociones</p>
      </div>

      <!-- Contexto del juego -->
      <div class="contexto-card">
        <h2 class="contexto-titulo">📖 ¿Cómo jugar?</h2>
        <div class="contexto-lista">
          <p class="contexto-item">🎯 <strong>Objetivo:</strong> Arma caras expresando diferentes emociones</p>
          <p class="contexto-item">🧩 <strong>Mecánica:</strong> Arrastra las partes faciales a las zonas correctas</p>
          <p class="contexto-item">🎨 <strong>Aprende:</strong> Identifica y construye expresiones emocionales</p>
          <p class="contexto-item">⭐ <strong>Progresa:</strong> Completa desafíos y mejora tus habilidades</p>
        </div>
      </div>

      <!-- Modos de juego -->
      <div class="modos-grid">
        
        <!-- Modo Práctica -->
        <div class="modo-card">
          <div class="modo-emoji">🎯</div>
          <h3 class="modo-titulo">Modo Práctica</h3>
          <p class="modo-descripcion">Sin presión de tiempo. Aprende a tu ritmo</p>
          <button class="btn-modo btn-verde" (click)="irASeleccion('practica')">
            Jugar
          </button>
        </div>

        <!-- Modo Contrarreloj -->
        <div class="modo-card">
          <div class="modo-emoji">⏱️</div>
          <h3 class="modo-titulo">Contrarreloj</h3>
          <p class="modo-descripcion">¡Completa antes de que termine el tiempo!</p>
          <button class="btn-modo btn-naranja" (click)="irASeleccion('contrarreloj')">
            Jugar
          </button>
        </div>

        <!-- Modo Desafío -->
        <div class="modo-card">
          <div class="modo-emoji">🏆</div>
          <h3 class="modo-titulo">Desafío</h3>
          <p class="modo-descripcion">Múltiples emociones. ¡Pon a prueba tu memoria!</p>
          <button class="btn-modo btn-morado" (click)="irASeleccion('desafio')">
            Jugar
          </button>
        </div>

      </div>

      <!-- Estadísticas -->
      <div class="estadisticas-card" *ngIf="totalJugados > 0">
        <h3 class="estadisticas-titulo">📊 Tus Estadísticas</h3>
        <div class="estadisticas-grid">
          <div class="estad-item">
            <span class="estad-valor">{{ totalJugados }}</span>
            <span class="estad-label">Jugados</span>
          </div>
          <div class="estad-item">
            <span class="estad-valor">{{ puntaje }}</span>
            <span class="estad-label">Puntos</span>
          </div>
          <div class="estad-item">
            <span class="estad-valor">{{ racha }}</span>
            <span class="estad-label">Racha</span>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- ========== PANTALLA DE SELECCIÓN DE EMOCIÓN ========== -->
  <div *ngIf="pantalla === 'seleccion'" class="pantalla-seleccion">
    <button class="btn-volver" (click)="volverAlInicio()">
      ← Volver
    </button>
    
    <h2 class="titulo-seleccion">Elige una emoción para armar</h2>
    
    <div class="emociones-grid">
      <div 
        *ngFor="let key of getEmocionesKeys()"
        class="emocion-card"
        [style.border-color]="emociones[key].color"
        (click)="iniciarJuego(key)">
        <div class="emocion-emoji" [style.color]="emociones[key].color">
          {{ emociones[key].emoji }}
        </div>
        <h3 class="emocion-nombre">{{ emociones[key].nombre }}</h3>
      </div>
    </div>
  </div>

  <!-- ========== PANTALLA DE JUEGO ========== -->
  <div *ngIf="pantalla === 'juego' && emocionActual" class="pantalla-juego">
    
    <!-- Header del juego -->
    <div class="header-juego">
      <button class="btn-volver" (click)="volverASeleccion()">
        ← Volver
      </button>
      
      <div class="info-juego">
        <h2 class="emocion-objetivo">
          Arma la emoción: 
          <span [style.color]="getColorEmocion(emocionActual!)">
            {{ emociones[emocionActual!].emoji }} {{ emociones[emocionActual!].nombre }}
          </span>
        </h2>
        
        <div *ngIf="modoJuego === 'contrarreloj'" class="tiempo-restante">
          ⏱️ Tiempo: 
          <span [style.color]="tiempo < 20 ? '#ff4444' : '#4CAF50'" style="font-weight: bold;">
            {{ tiempo }}s
          </span>
        </div>
        
        <div class="puntaje-actual">
          ⭐ Puntos: {{ puntaje }}
        </div>
      </div>
    </div>

    <div class="juego-area">
      
      <!-- Área de la cara -->
      <div class="cara-container">
        <div class="cara-fondo">
          
          <!-- Zona de cejas -->
          <div 
            class="zona-cejas"
            (dragover)="handleDragOver($event)"
            (drop)="handleDrop('cejas')">
            <div *ngIf="partesColocadas.cejas; else zonaCejasVacia" class="parte-colocada">
              <span class="parte-emoji-grande">{{ partesColocadas.cejas.emoji }}</span>
              <button class="btn-quitar" (click)="quitarParte('cejas')">×</button>
            </div>
            <ng-template #zonaCejasVacia>
              <div class="zona-vacia">
                <span class="texto-zona">Cejas</span>
              </div>
            </ng-template>
          </div>

          <!-- Zona de ojos -->
          <div 
            class="zona-ojos"
            (dragover)="handleDragOver($event)"
            (drop)="handleDrop('ojos')">
            <div *ngIf="partesColocadas.ojos; else zonaOjosVacia" class="parte-colocada">
              <span class="parte-emoji-grande">{{ partesColocadas.ojos.emoji }}</span>
              <button class="btn-quitar" (click)="quitarParte('ojos')">×</button>
            </div>
            <ng-template #zonaOjosVacia>
              <div class="zona-vacia">
                <span class="texto-zona">Ojos</span>
              </div>
            </ng-template>
          </div>

          <!-- Nariz fija -->
          <div class="nariz-fija">
            <span style="font-size: 2rem;">▽</span>
          </div>

          <!-- Zona de boca -->
          <div 
            class="zona-boca"
            (dragover)="handleDragOver($event)"
            (drop)="handleDrop('boca')">
            <div *ngIf="partesColocadas.boca; else zonaBocaVacia" class="parte-colocada">
              <span class="parte-emoji-grande">{{ partesColocadas.boca.emoji }}</span>
              <button class="btn-quitar" (click)="quitarParte('boca')">×</button>
            </div>
            <ng-template #zonaBocaVacia>
              <div class="zona-vacia">
                <span class="texto-zona">Boca</span>
              </div>
            </ng-template>
          </div>

        </div>
      </div>

      <!-- Panel de partes disponibles -->
      <div class="panel-partes">
        <h3 class="titulo-panel-partes">🧩 Partes Disponibles</h3>
        
        <!-- Cejas -->
        <div class="categoria-partes">
          <h4 class="categoria-titulo">Cejas</h4>
          <div class="partes-grid">
            <div
              *ngFor="let parte of partesDisponibles.cejas"
              class="parte-disponible"
              draggable="true"
              (dragstart)="handleDragStart('cejas', parte)">
              <span class="parte-emoji">{{ parte.emoji }}</span>
              <span class="parte-nombre">{{ parte.nombre }}</span>
            </div>
          </div>
        </div>

        <!-- Ojos -->
        <div class="categoria-partes">
          <h4 class="categoria-titulo">Ojos</h4>
          <div class="partes-grid">
            <div
              *ngFor="let parte of partesDisponibles.ojos"
              class="parte-disponible"
              draggable="true"
              (dragstart)="handleDragStart('ojos', parte)">
              <span class="parte-emoji">{{ parte.emoji }}</span>
              <span class="parte-nombre">{{ parte.nombre }}</span>
            </div>
          </div>
        </div>

        <!-- Bocas -->
        <div class="categoria-partes">
          <h4 class="categoria-titulo">Bocas</h4>
          <div class="partes-grid">
            <div
              *ngFor="let parte of partesDisponibles.boca"
              class="parte-disponible"
              draggable="true"
              (dragstart)="handleDragStart('boca', parte)">
              <span class="parte-emoji">{{ parte.emoji }}</span>
              <span class="parte-nombre">{{ parte.nombre }}</span>
            </div>
          </div>
        </div>

      </div>

    </div>

    <!-- Botón verificar -->
    <div *ngIf="juegoCompletado()" class="contenedor-verificar">
      <button class="btn-verificar" (click)="verificarRespuesta()">
        ✓ Verificar Respuesta
      </button>
    </div>

    <!-- Pista -->
    <div class="pista-container">
      <button class="btn-pista" (click)="togglePista()">
        💡 {{ mostrarPista ? 'Ocultar' : 'Ver' }} Pista
      </button>
      <p *ngIf="mostrarPista" class="texto-pista">
        {{ emociones[emocionActual!].pista }}
      </p>
    </div>

  </div>

  <!-- ========== PANTALLA DE COMPLETADO ========== -->
  <div *ngIf="pantalla === 'completado'" class="pantalla-completado">
    <div class="contenido-completado">
      
      <div class="celebracion">
        <div class="celebracion-emoji">🎉</div>
        <h2 class="celebracion-titulo">¡Excelente Trabajo!</h2>
        <p class="celebracion-subtitulo">Has completado la emoción correctamente</p>
      </div>

      <div class="stats-finales">
        <div class="stat-final">
          <span class="stat-icono">⭐</span>
          <span class="stat-valor">{{ puntaje }}</span>
          <span class="stat-label">Puntos Totales</span>
        </div>
        
        <div *ngIf="modoJuego === 'contrarreloj'" class="stat-final">
          <span class="stat-icono">⏱️</span>
          <span class="stat-valor">{{ tiempo }}s</span>
          <span class="stat-label">Tiempo Restante</span>
        </div>
        
        <div class="stat-final">
          <span class="stat-icono">🔥</span>
          <span class="stat-valor">{{ racha }}</span>
          <span class="stat-label">Racha Actual</span>
        </div>
      </div>

      <div class="botones-completado">
        <button class="btn-completado btn-verde" (click)="volverASeleccion()">
          🎭 Otra Emoción
        </button>
        <button class="btn-completado btn-azul" (click)="volverAlInicio()">
          🏠 Menú Principal
        </button>
      </div>

    </div>
  </div>

</div>