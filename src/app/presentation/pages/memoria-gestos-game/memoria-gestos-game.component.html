<div class="game-container">
  <!-- Header del juego -->
  <header class="game-header">
    <div class="header-content">
      <button class="btn-back" (click)="volverAJuegos()">
        <span class="back-icon">â†</span>
        <span>Volver</span>
      </button>
      
      <div class="game-info">
        <h1>ğŸ§  Memoria de Gestos</h1>
        <p>Recuerda y repite la secuencia de gestos faciales</p>
      </div>
      
      <div class="game-stats">
        <div class="stat">
          <span class="stat-label">Nivel</span>
          <span class="stat-value">{{ nivelActual }}/{{ maxNiveles }}</span>
        </div>
      </div>
    </div>
  </header>

  <!-- Pantalla de instrucciones -->
  <main class="game-main" *ngIf="faseJuego === 'instrucciones'">
    <div class="instructions-screen">
      <div class="instructions-card">
        <div class="instructions-header">
          <h2>ğŸ“‹ CÃ³mo Jugar</h2>
          <div class="difficulty-badge">{{ getDificultadTexto() }}</div>
        </div>
        
        <div class="instructions-content">
          <div class="step">
            <div class="step-number">1</div>
            <div class="step-text">
              <strong>TÃ³mate fotos de cada gesto</strong>
              <p>Primero capturarÃ¡s una foto haciendo cada gesto facial</p>
            </div>
          </div>
          
          <div class="step">
            <div class="step-number">2</div>
            <div class="step-text">
              <strong>Observa la secuencia</strong>
              <p>VerÃ¡s tus fotos en un orden especÃ­fico - Â¡memoriza el orden!</p>
            </div>
          </div>
          
          <div class="step">
            <div class="step-number">3</div>
            <div class="step-text">
              <strong>Arrastra las fotos en orden</strong>
              <p>Arrastra tus fotos a los espacios en el mismo orden que las viste</p>
            </div>
          </div>
        </div>
        
        <div class="gestos-preview">
          <h3>ğŸ­ Gestos a Capturar</h3>
          <div class="gestos-grid">
            <div *ngFor="let gesto of gestosDisponibles" class="gesto-preview">
              <span class="gesto-emoji">{{ gesto.emoji }}</span>
              <span class="gesto-nombre">{{ gesto.nombre }}</span>
            </div>
          </div>
        </div>
        
        <button class="btn-start" (click)="saltarInstrucciones()">
          ğŸ“¸ Â¡Empezar a Capturar!
        </button>
      </div>
    </div>
  </main>

  <!-- FASE DE CAPTURA INICIAL -->
  <main class="game-main" *ngIf="faseJuego === 'capturando-inicial'">
    
    <!-- Progreso de captura -->
    <div class="capture-progress" *ngIf="!todasFotosTomadas">
      <h2>ğŸ“¸ Captura tus gestos</h2>
      <div class="progress-bar-container">
        <div class="progress-bar-fill" [style.width.%]="(getFotosCapturadas() / gestosDisponibles.length) * 100"></div>
      </div>
      <p class="progress-text">{{ getFotosCapturadas() }} de {{ gestosDisponibles.length }} gestos capturados</p>
    </div>

    <!-- GalerÃ­a de fotos capturadas -->
    <div class="fotos-capturadas-grid">
      <div *ngFor="let gesto of gestosDisponibles" 
           class="foto-capturada-item"
           [class.capturada]="gesto.imagenCapturada">
        <div class="foto-preview" *ngIf="gesto.imagenCapturada">
          <img [src]="gesto.imagenCapturada" [alt]="gesto.nombre">
        </div>
        <div class="foto-placeholder" *ngIf="!gesto.imagenCapturada">
          <span class="placeholder-emoji">{{ gesto.emoji }}</span>
        </div>
        <div class="foto-nombre">{{ gesto.nombre }}</div>
        <div class="foto-status">
          <span *ngIf="gesto.imagenCapturada" class="status-check">âœ“</span>
          <span *ngIf="!gesto.imagenCapturada" class="status-pending">ğŸ“·</span>
        </div>
      </div>
    </div>

    <!-- Panel de captura activo con 2 columnas -->
    <div class="capture-active-panel" *ngIf="gestoCapturando && !todasFotosTomadas">
      
      <div class="capture-layout">
        
        <!-- COLUMNA IZQUIERDA: Video -->
        <div class="video-column">
          
          <!-- Mensaje de validaciÃ³n arriba del video -->
          <div class="mensaje-validacion" *ngIf="mensajeValidacion">
            <p [class.correcto]="movimientoDetectado" [class.incorrecto]="!movimientoDetectado">
              {{ mensajeValidacion }}
            </p>
          </div>

          <!-- Video de la cÃ¡mara con canvas superpuesto -->
          <div class="video-wrapper">
            <video #videoElement autoplay playsinline muted></video>
            <canvas #canvasElement class="canvas-overlay"></canvas>
            
            <!-- Overlay de resultado despuÃ©s de captura -->
            <div class="resultado-overlay-video" *ngIf="resultadoDeteccion">
              <div class="resultado-icono-video" 
                   [class.correcto]="resultadoDeteccion === 'correcto'"
                   [class.incorrecto]="resultadoDeteccion === 'incorrecto'">
                {{ resultadoDeteccion === 'correcto' ? 'âœ…' : 'âŒ' }}
              </div>
              <div class="resultado-texto-video">{{ mensajeDeteccion }}</div>
            </div>
          </div>

          <button class="btn-capture-photo" 
                  (click)="capturarFotoInicial()"
                  [disabled]="!movimientoDetectado || resultadoDeteccion !== null">
            ğŸ“· Capturar Foto
          </button>
        </div>

        <!-- COLUMNA DERECHA: Tarjeta del gesto -->
        <div class="gesto-card-column">
          <div class="gesto-card-puzzle"
               [class.card-correcto]="movimientoDetectado"
               [class.card-incorrecto]="!movimientoDetectado">
            <div class="gesto-icon-grande">{{ gestoCapturando.emoji }}</div>
            <h3 class="gesto-titulo">{{ gestoCapturando.nombre }}</h3>
            <p class="gesto-instruccion-texto">{{ gestoCapturando.instruccion }}</p>
          </div>
        </div>

      </div>

    </div>

    <!-- Mensaje de finalizaciÃ³n de captura -->
    <div class="captura-completa" *ngIf="todasFotosTomadas">
      <div class="completa-icono">âœ…</div>
      <h2>Â¡Todas las fotos capturadas!</h2>
      <p>Preparando el juego...</p>
      <div class="loading-dots">
        <span></span><span></span><span></span>
      </div>
    </div>

  </main>

  <!-- ÃREA PRINCIPAL DEL JUEGO -->
  <main class="game-main" *ngIf="faseJuego !== 'instrucciones' && faseJuego !== 'capturando-inicial' && faseJuego !== 'completado'">
    
    <!-- Ãrea de demostraciÃ³n -->
    <div class="demo-area" *ngIf="mostrandoSecuencia">
      <div class="demo-header">
        <h3>ğŸ‘€ Observa la secuencia</h3>
        <div class="sequence-progress">
          <span *ngFor="let gesto of secuenciaActual; let i = index"
                class="progress-dot"
                [class.active]="i === indiceGestoActual"
                [class.completed]="i < indiceGestoActual">
          </span>
        </div>
      </div>
      
      <div class="demo-gesture" *ngIf="gestoMostrando">
        <div class="gesture-display">
          <img *ngIf="gestoMostrando.imagenCapturada" 
               [src]="gestoMostrando.imagenCapturada" 
               [alt]="gestoMostrando.nombre"
               class="gesture-image">
          <h4>{{ gestoMostrando.nombre }}</h4>
        </div>
      </div>
      
      <div class="demo-waiting" *ngIf="!gestoMostrando">
        <div class="waiting-dots">
          <span></span><span></span><span></span>
        </div>
      </div>
    </div>

    <!-- Mensaje de fase -->
    <div class="phase-message" *ngIf="!mostrandoSecuencia && faseJuego === 'esperando'">
      <div class="message-content">
        <h3>ğŸ¯ Nivel {{ nivelActual }}</h3>
        <p>PrepÃ¡rate para ver la secuencia...</p>
      </div>
    </div>

    <!-- ğŸ¯ ZONA DE DRAG AND DROP HORIZONTAL -->
    <div class="drag-drop-horizontal" *ngIf="faseJuego === 'jugando'">
      
      <!-- Instrucciones compactas -->
      <div class="drag-instructions-horizontal">
        <h3>ğŸ¤” Arrastra las fotos en el orden correcto</h3>
        <div class="progress-indicator">{{ respuestaJugador.length }} / {{ secuenciaActual.length }}</div>
      </div>

      <!-- LAYOUT HORIZONTAL -->
      <div class="horizontal-game-layout">
        
        <!-- ğŸ“¦ SLOTS A LA IZQUIERDA/ARRIBA -->
        <div class="drop-zone-horizontal">
          <div *ngFor="let slot of slots; let i = index"
               class="drop-slot-horizontal"
               [class.filled]="slot.gesto !== null"
               [class.drag-over]="slot.dragOver"
               (dragover)="onDragOver($event, i)"
               (dragleave)="onDragLeave($event, i)"
               (drop)="onDrop($event, i)">
            
            <!-- NÃºmero del slot -->
            <div class="slot-number" *ngIf="!slot.gesto">{{ i + 1 }}</div>
            
            <!-- Foto si estÃ¡ colocada -->
            <div class="slot-content" *ngIf="slot.gesto">
              <img [src]="slot.gesto.imagenCapturada" [alt]="slot.gesto.nombre">
              <button class="btn-remove-horizontal" (click)="removerFoto(i)">âœ•</button>
            </div>
            
            <!-- Indicador de drop -->
            <div class="drop-indicator" *ngIf="!slot.gesto && slot.dragOver">
              Suelta aquÃ­
            </div>
          </div>
        </div>

        <!-- SEPARADOR VISUAL -->
        <div class="separator-arrow">â¡ï¸</div>

        <!-- ğŸ–¼ï¸ FOTOS DISPONIBLES A LA DERECHA -->
        <div class="available-photos-horizontal">
          <h4>ğŸ“¸ Tus fotos:</h4>
          <div class="photos-horizontal">
            <div *ngFor="let gesto of fotosDisponibles; trackBy: trackByGestoUniqueId"
                 class="draggable-photo-horizontal"
                 [class.disabled]="gesto.usado"
                 draggable="true"
                 (dragstart)="onDragStart($event, gesto)"
                 (dragend)="onDragEnd($event)">
              <img [src]="gesto.imagenCapturada" [alt]="gesto.nombre">
              <span class="photo-name-horizontal">{{ gesto.nombre }}</span>
              <div class="used-overlay" *ngIf="gesto.usado">âœ“</div>
            </div>
          </div>
        </div>

      </div>

      <!-- BotÃ³n de verificar -->
      <button class="btn-verify-horizontal" 
              (click)="verificarOrden()"
              [disabled]="respuestaJugador.length !== secuenciaActual.length">
        âœ… Verificar Orden
      </button>
    </div>

    <!-- Mensaje de error -->
    <div class="error-message" *ngIf="faseJuego === 'error'">
      <div class="error-content">
        <div class="error-icon">âŒ</div>
        <h3>Â¡Oops!</h3>
        <p>Ese no era el orden correcto. Â¡IntÃ©ntalo de nuevo!</p>
      </div>
    </div>

  </main>

  <!-- Modal de juego completado -->
  <div class="completion-modal" *ngIf="faseJuego === 'completado'">
    <div class="modal-content">
      <div class="celebration">
        <div class="celebration-emoji">ğŸ‰</div>
        <h2>Â¡IncreÃ­ble memoria!</h2>
        <p>Has completado el nivel {{ nivelActual }}</p>
      </div>
      
      <div class="final-stats">
        <div class="stat-final">
          <span class="stat-icon">ğŸ¯</span>
          <span class="stat-text">Nivel alcanzado: {{ nivelActual }}/{{ maxNiveles }}</span>
        </div>
      </div>
      
      <div class="stars-rating">
        <span class="star filled">â­</span>
        <span class="star filled">â­</span>
        <span class="star filled">â­</span>
      </div>
      
      <div class="modal-actions">
        <button class="btn-secondary" (click)="reiniciarJuego()">
          ğŸ”„ Jugar de Nuevo
        </button>
        
        <button class="btn-primary" (click)="siguienteJuego()">
          â¡ï¸ Siguiente Juego
        </button>
        
        <button class="btn-outline" (click)="volverAJuegos()">
          ğŸ  Volver a Juegos
        </button>
      </div>
    </div>
  </div>

  <!-- Overlay del modal -->
  <div class="modal-overlay" *ngIf="faseJuego === 'completado'" (click)="volverAJuegos()"></div>
</div>