<div class="game-container">
  <!-- Header del juego - SIN NIVEL EN INSTRUCCIONES -->
  <header class="game-header">
    <div class="header-content">
      <button class="btn-back" (click)="volverAJuegos()">
        <span class="back-icon">←</span>
        <span>Volver</span>
      </button>
      
      <div class="game-info">
        <h1>Memoria de Gestos</h1>
        <p>Recuerda y repite la secuencia de gestos faciales</p>
      </div>
      
      <!-- Solo mostrar nivel cuando NO estamos en instrucciones -->
      <div class="game-stats" *ngIf="faseJuego !== 'instrucciones'">
        <div class="stat">
          <span class="stat-label">Nivel</span>
          <span class="stat-value">{{ nivelActual }}/{{ maxNiveles }}</span>
        </div>
      </div>
      
      <!-- Espacio vacío para mantener el layout cuando no hay stats -->
      <div class="game-stats-placeholder" *ngIf="faseJuego === 'instrucciones'"></div>
    </div>
  </header>

  <!-- Pantalla de instrucciones - ESTILO PAREJAS DE SÍLABAS -->
  <main class="game-main instructions-screen" *ngIf="faseJuego === 'instrucciones'">
    <div class="instructions-card">
      <div class="instructions-header">
        <h2>¿Cómo se juega?</h2>
        <div class="game-icon"></div>
      </div>
      
      <div class="instructions-content">
        <div class="step">
          <div class="step-number">1</div>
          <div class="step-text">
            <strong>Tómate fotos de cada gesto</strong>
            <p>Primero capturarás una foto haciendo cada gesto facial</p>
          </div>
        </div>
        
        <div class="step">
          <div class="step-number">2</div>
          <div class="step-text">
            <strong>Observa la secuencia</strong>
            <p>Verás tus fotos en un orden específico - ¡memoriza el orden!</p>
          </div>
        </div>
        
        <div class="step">
          <div class="step-number">3</div>
          <div class="step-text">
            <strong>Arrastra las fotos en orden</strong>
            <p>Arrastra tus fotos a los espacios en el mismo orden que las viste</p>
          </div>
        </div>
      </div>
      
      <div class="gestos-preview">
        <h3>Gestos a Capturar</h3>
        <div class="gestos-grid-preview">
          <div *ngFor="let gesto of gestosDisponibles" class="gesto-preview-item">
            <span class="gesto-emoji">{{ gesto.emoji }}</span>
            <span class="gesto-nombre">{{ gesto.nombre }}</span>
          </div>
        </div>
      </div>
      
      <button class="btn-start" (click)="saltarInstrucciones()">
        ¡Empezar a Capturar!
      </button>
    </div>
  </main>

  <!-- FASE DE CAPTURA INICIAL -->
  <main class="game-main" *ngIf="faseJuego === 'capturando-inicial'">
    
    <!-- Progreso de captura -->
    <div class="capture-progress" *ngIf="!todasFotosTomadas">
      <h2>Captura tus gestos</h2>
      <div class="progress-bar-container">
        <div class="progress-bar-fill" [style.width.%]="(getFotosCapturadas() / gestosDisponibles.length) * 100"></div>
      </div>
      <p class="progress-text">{{ getFotosCapturadas() }} de {{ gestosDisponibles.length }} gestos capturados</p>
    </div>

    <!-- Galería de fotos capturadas -->
    <div class="fotos-capturadas-grid">
      <div *ngFor="let gesto of gestosDisponibles" 
           class="foto-capturada-item"
           [class.capturada]="gesto.imagenCapturada">
        <div class="foto-preview" *ngIf="gesto.imagenCapturada">
          <img [src]="gesto.imagenCapturada" [alt]="gesto.nombre">
        </div>
        <div class="foto-placeholder" *ngIf="!gesto.imagenCapturada">
          <span class="placeholder-emoji">{{ gesto.emoji }}</span>
        </div>
        <div class="foto-nombre">{{ gesto.nombre }}</div>
        <div class="foto-status">
          <span *ngIf="gesto.imagenCapturada" class="status-check">✓</span>
          <span *ngIf="!gesto.imagenCapturada" class="status-pending">○</span>
        </div>
      </div>
    </div>

    <!-- Panel de captura activo con 2 columnas -->
    <div class="capture-active-panel" *ngIf="gestoCapturando && !todasFotosTomadas">
      
      <div class="capture-layout">
        
        <!-- COLUMNA IZQUIERDA: Video -->
        <div class="video-column">
          
          <!-- Mensaje de validación arriba del video -->
          <div class="mensaje-validacion" *ngIf="mensajeValidacion">
            <p [class.correcto]="movimientoDetectado" [class.incorrecto]="!movimientoDetectado">
              {{ mensajeValidacion }}
            </p>
          </div>

          <!-- Video de la cámara con canvas superpuesto -->
          <div class="video-wrapper">
            <video #videoElement autoplay playsinline muted></video>
            <canvas #canvasElement class="canvas-overlay"></canvas>
            
            <!-- Overlay de resultado después de captura -->
            <div class="resultado-overlay-video" *ngIf="resultadoDeteccion">
              <div class="resultado-icono-video" 
                   [class.correcto]="resultadoDeteccion === 'correcto'"
                   [class.incorrecto]="resultadoDeteccion === 'incorrecto'">
                {{ resultadoDeteccion === 'correcto' ? '✓' : '✕' }}
              </div>
              <div class="resultado-texto-video">{{ mensajeDeteccion }}</div>
            </div>
          </div>

          <button class="btn-capture-photo" 
                  (click)="capturarFotoInicial()"
                  [disabled]="!movimientoDetectado || resultadoDeteccion !== null">
            Capturar Foto
          </button>
        </div>

        <!-- COLUMNA DERECHA: Tarjeta del gesto -->
        <div class="gesto-card-column">
          <div class="gesto-card-puzzle"
               [class.card-correcto]="movimientoDetectado"
               [class.card-incorrecto]="!movimientoDetectado">
            <div class="gesto-icon-grande">{{ gestoCapturando.emoji }}</div>
            <h3 class="gesto-titulo">{{ gestoCapturando.nombre }}</h3>
            <p class="gesto-instruccion-texto">{{ gestoCapturando.instruccion }}</p>
          </div>
        </div>

      </div>

    </div>

    <!-- Mensaje de finalización de captura -->
    <div class="captura-completa" *ngIf="todasFotosTomadas">
      <div class="completa-icono">✓</div>
      <h2>¡Todas las fotos capturadas!</h2>
      <p>Preparando el juego...</p>
      <div class="loading-dots">
        <span></span><span></span><span></span>
      </div>
    </div>

  </main>

  <!-- ÁREA PRINCIPAL DEL JUEGO -->
  <main class="game-main" *ngIf="faseJuego !== 'instrucciones' && faseJuego !== 'capturando-inicial' && faseJuego !== 'completado'">
    
    <!-- Área de demostración -->
    <div class="demo-area" *ngIf="mostrandoSecuencia">
      <div class="demo-header">
        <h3>Observa la secuencia</h3>
        <div class="sequence-progress">
          <span *ngFor="let gesto of secuenciaActual; let i = index"
                class="progress-dot"
                [class.active]="i === indiceGestoActual"
                [class.completed]="i < indiceGestoActual">
          </span>
        </div>
      </div>
      
      <div class="demo-gesture" *ngIf="gestoMostrando">
        <div class="gesture-display">
          <img *ngIf="gestoMostrando.imagenCapturada" 
               [src]="gestoMostrando.imagenCapturada" 
               [alt]="gestoMostrando.nombre"
               class="gesture-image">
          <h4>{{ gestoMostrando.nombre }}</h4>
        </div>
      </div>
      
      <div class="demo-waiting" *ngIf="!gestoMostrando">
        <div class="waiting-dots">
          <span></span><span></span><span></span>
        </div>
      </div>
    </div>

    <!-- Mensaje de fase -->
    <div class="phase-message" *ngIf="!mostrandoSecuencia && faseJuego === 'esperando'">
      <div class="message-content">
        <h3>Nivel {{ nivelActual }}</h3>
        <p>Prepárate para ver la secuencia...</p>
      </div>
    </div>

    <!-- ZONA DE DRAG AND DROP HORIZONTAL - OCULTAR CUANDO SE MUESTRA SECUENCIA -->
    <div class="drag-drop-horizontal" *ngIf="faseJuego === 'jugando' && !mostrandoSecuencia">
      
      <!-- Instrucciones compactas -->
      <div class="drag-instructions-horizontal">
        <h3>Arrastra las fotos en el orden correcto</h3>
        <div class="progress-indicator">{{ respuestaJugador.length }} / {{ secuenciaActual.length }}</div>
      </div>

      <!-- LAYOUT HORIZONTAL -->
      <div class="horizontal-game-layout">
        
        <!-- SLOTS A LA IZQUIERDA/ARRIBA -->
        <div class="drop-zone-horizontal">
          <div *ngFor="let slot of slots; let i = index"
               class="drop-slot-horizontal"
               [class.filled]="slot.gesto !== null"
               [class.drag-over]="slot.dragOver"
               (dragover)="onDragOver($event, i)"
               (dragleave)="onDragLeave($event, i)"
               (drop)="onDrop($event, i)">
            
            <!-- Número del slot -->
            <div class="slot-number" *ngIf="!slot.gesto">{{ i + 1 }}</div>
            
            <!-- Foto si está colocada -->
            <div class="slot-content" *ngIf="slot.gesto">
              <img [src]="slot.gesto.imagenCapturada" [alt]="slot.gesto.nombre">
              <button class="btn-remove-horizontal" (click)="removerFoto(i)">✕</button>
            </div>
            
            <!-- Indicador de drop -->
            <div class="drop-indicator" *ngIf="!slot.gesto && slot.dragOver">
              Suelta aquí
            </div>
          </div>
        </div>

        <!-- SEPARADOR VISUAL -->
        <div class="separator-arrow">→</div>

        <!-- FOTOS DISPONIBLES A LA DERECHA -->
        <div class="available-photos-horizontal">
          <h4>Tus fotos:</h4>
          <div class="photos-horizontal">
            <div *ngFor="let gesto of fotosDisponibles; trackBy: trackByGestoUniqueId"
                 class="draggable-photo-horizontal"
                 [class.disabled]="gesto.usado"
                 draggable="true"
                 (dragstart)="onDragStart($event, gesto)"
                 (dragend)="onDragEnd($event)">
              <img [src]="gesto.imagenCapturada" [alt]="gesto.nombre">
              <span class="photo-name-horizontal">{{ gesto.nombre }}</span>
              <div class="used-overlay" *ngIf="gesto.usado">✓</div>
            </div>
          </div>
        </div>

      </div>

      <!-- Botón de verificar -->
      <div class="botones-accion">
        <button class="btn-ver-secuencia" 
                (click)="verSecuenciaOtraVez()"
                [disabled]="!puedeVerSecuenciaOtraVez || mostrandoSecuencia"
                *ngIf="puedeVerSecuenciaOtraVez">
          <span class="btn-icon"></span>
          Ver secuencia otra vez
        </button>
        
        <button class="btn-verify-horizontal" 
                (click)="verificarOrden()"
                [disabled]="respuestaJugador.length !== secuenciaActual.length || mostrandoSecuencia">
          Verificar Orden
        </button>
      </div>
    </div>

    <!-- Mensaje de error -->
    <div class="error-message" *ngIf="faseJuego === 'error'">
      <div class="error-content">
        <div class="error-icon">✕</div>
        <h3>¡Oops!</h3>
        <p>Ese no era el orden correcto. ¡Inténtalo de nuevo!</p>
      </div>
    </div>

  </main>

  <!-- Modal de juego completado - PROFESIONAL -->
  <div class="completion-modal" *ngIf="faseJuego === 'completado'">
    <div class="modal-content">
      <div class="modal-header-icon">
        <svg class="check-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
          <path d="M8 12l2.5 2.5L16 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      
      <h2 class="modal-titulo">¡Felicitaciones!</h2>
      <p class="modal-subtitulo">Has completado todos los niveles del juego</p>
      
      <div class="resultado-card">
        <div class="resultado-item">
          <span class="resultado-label">Niveles completados</span>
          <span class="resultado-valor">{{ nivelActual }} de {{ maxNiveles }}</span>
        </div>
      </div>
      
      <div class="modal-actions">
        <button class="btn-secondary" (click)="reiniciarJuego()">
          Jugar de Nuevo
        </button>
        
        <button class="btn-primary" (click)="siguienteJuego()">
          Siguiente Juego
        </button>
        
        <button class="btn-outline" (click)="volverAJuegos()">
          Volver a Juegos
        </button>
      </div>
    </div>
  </div>

  <!-- Overlay del modal -->
  <div class="modal-overlay" *ngIf="faseJuego === 'completado'" (click)="volverAJuegos()"></div>
</div>