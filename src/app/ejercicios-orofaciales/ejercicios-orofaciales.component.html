<div class="ejercicios-container">
  
  
  <div class="secciones-menu" *ngIf="vistaActual === 'secciones'">
    
    <button class="btn-volver-dashboard" (click)="volverAlDashboard()">
      <span class="icono-flecha">â†</span>
      <span class="texto-btn">Volver al MenÃº Principal</span>
    </button>
    
    <div class="header-secciones">
      <h2>Ejercicios de FonoaudiologÃ­a</h2>
      <p class="subtitulo">Selecciona el Ã¡rea que quieres trabajar</p>
    </div>
    
    <div class="secciones-grid">
      <div 
        class="seccion-card" 
        *ngFor="let seccion of secciones"
        (click)="seleccionarSeccion(seccion)"
        [style.border-color]="seccion.color">
        
        <div class="seccion-imagen" [style.background-image]="'url(' + seccion.imagen + ')'"></div>
        
        <div class="seccion-contenido">
          <div class="seccion-icono" [style.color]="seccion.color">
            {{seccion.icono}}
          </div>
          
          <h3>{{seccion.nombre}}</h3>
          <p class="seccion-descripcion">{{seccion.descripcion}}</p>
          
          <div class="seccion-ejercicios-count">
            <div class="count-badge" [style.background-color]="seccion.color">
              <span class="count-numero">{{seccion.ejercicios.length}}</span>
              <span class="count-texto">ejercicios</span>
            </div>
          </div>
          
          <div class="btn-entrar" [style.background-color]="seccion.color">
            <span>Entrar â†’</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ğŸ“š VISTA 2: EJERCICIOS DE LA SECCIÃ“N SELECCIONADA -->
  <div class="ejercicios-seccion-menu" *ngIf="vistaActual === 'ejercicios' && seccionActiva">
    <div class="header-ejercicios-nuevo">
      <button class="btn-back-nuevo" (click)="volverASecciones()">
        â† Volver a Secciones
      </button>
      
      <div class="header-background" 
           [style.background-image]="'url(' + seccionActiva.imagen + ')'">
        <div class="header-overlay"></div>
        
        <div class="header-content">
          <h2 class="seccion-titulo-nuevo">{{seccionActiva.nombre}}</h2>
          <p class="seccion-descripcion-nuevo">{{seccionActiva.descripcion}}</p>
        </div>
      </div>
    </div>

    <div class="ejercicios-grid">
      <div 
        class="ejercicio-card" 
        *ngFor="let ejercicio of seccionActiva.ejercicios"
        (click)="iniciarEjercicio(ejercicio)"
        [style.border-color]="ejercicio.color">
        
        <div class="ejercicio-imagen-container">
          <img 
            [src]="ejercicio.imagen" 
            [alt]="ejercicio.nombre"
            class="ejercicio-imagen"
            [style.border-color]="ejercicio.color">
        </div>
        
        <h3>{{ejercicio.nombre}}</h3>
        <p>{{ejercicio.descripcion}}</p>
        
        <div class="ejercicio-duracion">
          <span class="duracion-icono">â±ï¸</span>
          <span>{{ejercicio.duracion}}s</span>
        </div>
        
        <!-- âœ… Badge de repeticiones del dÃ­a -->
        <div class="repeticiones-badge" *ngIf="getRepeticionesHoy(ejercicio.id) > 0">
          <span class="rep-numero">{{getRepeticionesHoy(ejercicio.id)}}/3</span>
          <span class="rep-texto">repeticiones hoy</span>
        </div>
        
        <!-- âœ… Completado HOY (3 repeticiones) -->
        <div class="ejercicio-completado-hoy" *ngIf="isEjercicioCompletadoHoy(ejercicio.id)">
          <span class="checkmark">âœ…</span>
          <span class="texto-completado">Â¡Completado hoy!</span>
        </div>
        
        <!-- ğŸ¯ BotÃ³n para iniciar (siempre disponible) -->
        <div class="btn-iniciar" 
             [style.background]="'linear-gradient(135deg, ' + ejercicio.color + ', ' + ejercicio.color + 'dd)'">
          <span *ngIf="!isEjercicioCompletadoHoy(ejercicio.id)">Â¡Comenzar!</span>
          <span *ngIf="isEjercicioCompletadoHoy(ejercicio.id)">Seguir Practicando</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ğŸ¯ VISTA 3: EJERCICIO ACTIVO - âœ¨ DISEÃ‘O BOOM MEJORADO -->
  <div class="ejercicio-activo-boom" *ngIf="vistaActual === 'activo' && ejercicioActivo">
    
    <!-- âœ¨ HEADER CON EFECTO NEÃ“N -->
    <div class="ejercicio-header-boom">
      <button class="btn-volver-boom" (click)="volverAlMenu()">
        <span class="btn-volver-icono">â†</span>
        <span class="btn-volver-texto">Volver a {{seccionActiva?.nombre}}</span>
      </button>
      
      <div class="titulo-ejercicio-neon">
        <div class="neon-wrapper">
          <h1 class="titulo-neon">
            <span class="nombre-ejercicio">{{ejercicioActivo.nombre}}</span>
          </h1>
          
          <!-- ğŸ‰ Indicador de completado HOY -->
          <div class="badge-completado-hoy" *ngIf="isEjercicioCompletadoHoy(ejercicioActivo.id)">
            <span class="badge-icono">âœ…</span>
            <span class="badge-texto">Â¡Ya completaste este ejercicio hoy!</span>
          </div>
          
          <!-- ğŸ”„ Contador de repeticiones -->
          <div class="badge-repeticiones-header" *ngIf="!isEjercicioCompletadoHoy(ejercicioActivo.id) && getRepeticionesHoy(ejercicioActivo.id) > 0">
            <span class="badge-icono">ğŸ”„</span>
            <span class="badge-texto">RepeticiÃ³n {{getRepeticionesHoy(ejercicioActivo.id) + 1}}/3</span>
          </div>
        </div>
      </div>
    </div>

    <!-- âœ¨ CONTENEDOR PRINCIPAL MEJORADO -->
    <div class="contenedor-boom">
      
      <!-- âœ¨ SECCIÃ“N DE VIDEO CON EFECTOS 3D -->
      <div class="seccion-video-boom">
        
        <!-- Marco del video con gradiente animado -->
        <div class="video-frame-3d">
          <div class="frame-gradient-border"></div>
          
          <div class="video-wrapper-boom">
            <video #videoElement class="input-video" playsinline autoplay muted></video>
            <canvas #canvasElement class="output-canvas"></canvas>
            
            <!-- âœ¨ FEEDBACK MEJORADO CON EFECTOS (solo mensajes) -->
            <div class="feedback-overlay-boom" *ngIf="isRecording && mensajeFeedback">
              <div class="feedback-message-boom" 
                   [class.success]="feedbackTipo === 'success'"
                   [class.warning]="feedbackTipo === 'warning'"
                   [class.error]="feedbackTipo === 'error'">
                <span class="feedback-icono">
                  <span *ngIf="feedbackTipo === 'success'">âœ¨</span>
                  <span *ngIf="feedbackTipo === 'warning'">ğŸ’ª</span>
                </span>
                <span class="feedback-texto">{{mensajeFeedback}}</span>
              </div>
            </div>

            <!-- âœ¨ EFECTO DE PARTÃCULAS CUANDO ESTÃ CORRECTO -->
            <div class="particles-overlay" *ngIf="feedbackTipo === 'success'">
              <div class="particle" *ngFor="let i of [1,2,3,4,5,6,7,8]"></div>
            </div>
          </div>
        </div>

        <!-- âœ¨ INSTRUCCIONES CON ANIMACIÃ“N TIPO BANNER -->
        <div class="instrucciones-boom">
          <div class="instrucciones-banner">
            <div class="banner-icono">ğŸ“¢</div>
            <div class="banner-texto">
              <p class="instruccion-principal">{{ejercicioActivo.instrucciones}}</p>
            </div>
            <div class="banner-decoracion"></div>
          </div>
        </div>
      </div>

      <!-- âœ¨ PANEL DE CONTROLES CON GLASSMORPHISM -->
      <div class="panel-controles-boom">
        
        <!-- âœ¨ TIMER CIRCULAR MOVIDO AQUÃ -->
        <div class="timer-circular-container" *ngIf="isRecording">
          <svg class="timer-circular-svg" viewBox="0 0 100 100">
            <circle class="timer-circle-bg" cx="50" cy="50" r="45"></circle>
            <circle 
              class="timer-circle-progress" 
              cx="50" 
              cy="50" 
              r="45"
              [style.stroke]="ejercicioActivo?.color"
              [style.stroke-dashoffset]="283 - (283 * progresoEjercicio / 100)">
            </circle>
          </svg>
          <div class="timer-numero" [style.color]="ejercicioActivo?.color">
            <span class="numero-grande">{{tiempoRestante}}</span>
            <span class="texto-pequeÃ±o">s</span>
          </div>
        </div>

        <!-- Barra de progreso MOVIDA AQUÃ -->
        <div class="progreso-container-boom" *ngIf="isRecording">
          <div class="progreso-bar-boom" 
               [style.width.%]="progresoEjercicio"
               [style.background]="'linear-gradient(90deg, ' + ejercicioActivo!.color + ', ' + ajustarBrillo(ejercicioActivo!.color, 20) + ')'">
            <div class="progreso-shine"></div>
          </div>
        </div>

        <!-- ğŸ‘ï¸ BOTÃ“N LANDMARKS MOVIDO AQUÃ -->
        <button class="btn-toggle-landmarks" 
                *ngIf="isRecording"
                (click)="mostrarLandmarks = !mostrarLandmarks"
                [class.activo]="mostrarLandmarks">
          <span class="icono-ojo">{{mostrarLandmarks ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸'}}</span>
          <span class="texto-toggle">{{mostrarLandmarks ? 'Ocultar GuÃ­a' : 'Mostrar GuÃ­a'}}</span>
        </button>
        
        <!-- Estado de carga mejorado -->
        <div *ngIf="!isRecording" class="loading-estado-boom">
          <div class="loading-rings">
            <div class="ring ring-1"></div>
            <div class="ring ring-2"></div>
            <div class="ring ring-3"></div>
          </div>
          <p class="loading-texto-boom">Iniciando cÃ¡mara...</p>
          <div class="loading-dots">
            <span class="dot dot-1">.</span>
            <span class="dot dot-2">.</span>
            <span class="dot dot-3">.</span>
          </div>
        </div>

        <!-- Botones con efectos 3D -->
        <div *ngIf="isRecording" class="botones-control-boom">
          <button (click)="reiniciarEjercicio()" class="btn-control-boom btn-reiniciar-boom">
            <div class="btn-bg-gradient"></div>
            <div class="btn-content">
              <span class="btn-icono-boom">ğŸ”„</span>
              <span class="btn-texto-boom">Reiniciar</span>
            </div>
            <div class="btn-shine"></div>
          </button>
          
          <button (click)="detenerEjercicio()" class="btn-control-boom btn-detener-boom">
            <div class="btn-bg-gradient"></div>
            <div class="btn-content">
              <span class="btn-icono-boom">â¹ï¸</span>
              <span class="btn-texto-boom">Detener</span>
            </div>
            <div class="btn-shine"></div>
          </button>
        </div>

        <!-- âœ¨ INDICADOR DE PROGRESO VISUAL -->
        <div *ngIf="isRecording" class="progreso-visual-panel">
          <div class="progreso-steps">
            <div class="step" 
                 *ngFor="let step of [1,2,3,4,5,6,7,8]"
                 [class.active]="(progresoEjercicio / 100 * 8) >= step">
            </div>
          </div>
        </div>

      </div>

    </div>
  </div>

  <!-- ğŸ‰ MODAL DE RESULTADOS MEJORADO -->
  <div class="modal-overlay" *ngIf="vistaActual === 'resultados' || mostrarResultados" (click)="cerrarModal()">
    <div class="modal-resultados-boom" (click)="$event.stopPropagation()">
      
      <!-- Badge de secciÃ³n -->
      <div class="modal-badge-seccion" *ngIf="seccionActiva" [style.background]="'linear-gradient(135deg, ' + seccionActiva.color + ', ' + ajustarBrillo(seccionActiva.color, -20) + ')'">
        <span class="badge-icono">{{seccionActiva.icono}}</span>
        <span class="badge-texto">{{seccionActiva.nombre}}</span>
      </div>
      
      <!-- TÃ­tulo principal -->
      <div class="modal-header-boom">
        <div class="confetti-animation" *ngIf="ultimoResultado && ultimoResultado.puntuacion >= 70">
          <span class="confetti" *ngFor="let i of [1,2,3,4,5,6,7,8]">ğŸ‰</span>
        </div>
        <h2 class="modal-titulo-boom">Â¡Ejercicio Completado!</h2>
      </div>
      
      <!-- Contenido del resultado -->
      <div class="modal-contenido-boom">
        
        <!-- Resultado: Excelente -->
        <div *ngIf="ultimoResultado && ultimoResultado.puntuacion >= 70" class="resultado-excelente-boom">
          <div class="emoji-grande">ğŸŒŸ</div>
          <h3 class="mensaje-principal">Â¡EXCELENTE!</h3>
          <p class="mensaje-secundario">
            Â¡Lo hiciste muy bien! Cada vez que practicas te vuelves mÃ¡s fuerte. Â¡Sigue asÃ­ campeÃ³n!
          </p>
        </div>
        
        <!-- Resultado: Buen intento -->
        <div *ngIf="ultimoResultado && ultimoResultado.puntuacion >= 40 && ultimoResultado.puntuacion < 70" class="resultado-bien-boom">
          <div class="emoji-grande">ğŸ’ª</div>
          <h3 class="mensaje-principal">Â¡BUEN INTENTO!</h3>
          <p class="mensaje-secundario">
            Vas por buen camino. Sigue practicando y mejorarÃ¡s cada dÃ­a mÃ¡s. Â¡No te rindas!
          </p>
        </div>
        
        <!-- Resultado: IntÃ©ntalo de nuevo -->
        <div *ngIf="ultimoResultado && ultimoResultado.puntuacion < 40" class="resultado-intenta-boom">
          <div class="emoji-grande">ğŸ¯</div>
          <h3 class="mensaje-principal">Â¡INTÃ‰NTALO DE NUEVO!</h3>
          <p class="mensaje-secundario">
            Parece que no pudimos detectar el ejercicio correctamente. AsegÃºrate de estar bien iluminado y de hacer el movimiento claramente. Â¡TÃº puedes!
          </p>
        </div>
        
        <!-- Resultado: Sin datos -->
        <div *ngIf="!ultimoResultado" class="resultado-completado-boom">
          <div class="emoji-grande">âœ…</div>
          <h3 class="mensaje-principal">Â¡COMPLETADO!</h3>
          <p class="mensaje-secundario">
            Has terminado el ejercicio. Â¡Sigue practicando!
          </p>
        </div>
        
      </div>
      
      <!-- Botones de acciÃ³n -->
      <div class="modal-acciones-boom">
        <button (click)="repetirEjercicio()" class="btn-modal-boom btn-repetir-boom">
          <span class="btn-texto">Repetir Ejercicio</span>
        </button>
        
        <button (click)="volverAlMenu()" class="btn-modal-boom btn-volver-menu-boom">
          <span class="btn-texto">Volver a {{seccionActiva?.nombre}}</span>
        </button>
        
        <button (click)="volverASecciones()" class="btn-modal-boom btn-otras-secciones-boom" *ngIf="seccionActiva">
          <span class="btn-texto">Otras Secciones</span>
        </button>
      </div>
      
    </div>
  </div>
  
</div>