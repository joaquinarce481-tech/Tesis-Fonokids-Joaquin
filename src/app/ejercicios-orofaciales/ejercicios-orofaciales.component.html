<div class="ejercicios-container">
  
  <!-- üìÇ VISTA 1: SELECTOR DE SECCIONES PRINCIPALES -->
  <div class="secciones-menu" *ngIf="vistaActual === 'secciones'">
    <!-- ‚úÖ BOT√ìN VOLVER AL DASHBOARD -->
    <button class="btn-volver-dashboard" (click)="volverAlDashboard()">
      <span class="icono-flecha">‚Üê</span>
      <span class="texto-btn">Volver al Men√∫ Principal</span>
    </button>
    
    <div class="header-secciones">
      <h2>Ejercicios de Fonoaudiolog√≠a</h2>
      <p class="subtitulo">Selecciona el √°rea que quieres trabajar</p>
    </div>
    
    <div class="secciones-grid">
      <div 
        class="seccion-card" 
        *ngFor="let seccion of secciones"
        (click)="seleccionarSeccion(seccion)"
        [style.border-color]="seccion.color">
        
        <!-- ‚úÖ NUEVA SECCI√ìN DE IMAGEN -->
        <div class="seccion-imagen" [style.background-image]="'url(' + seccion.imagen + ')'"></div>
        
        <!-- ‚úÖ CONTENEDOR DE CONTENIDO -->
        <div class="seccion-contenido">
          <!-- Emoji oculto por CSS pero mantiene compatibilidad -->
          <div class="seccion-icono" [style.color]="seccion.color">
            {{seccion.icono}}
          </div>
          
          <h3>{{seccion.nombre}}</h3>
          <p class="seccion-descripcion">{{seccion.descripcion}}</p>
          
          <!-- ‚úÖ SOLO MOSTRAR CANTIDAD DE EJERCICIOS -->
          <div class="seccion-ejercicios-count">
            <div class="count-badge" [style.background-color]="seccion.color">
              <span class="count-numero">{{seccion.ejercicios.length}}</span>
              <span class="count-texto">ejercicios</span>
            </div>
          </div>
          
          <div class="btn-entrar" [style.background-color]="seccion.color">
            <span>Entrar ‚Üí</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- üìö VISTA 2: EJERCICIOS DE LA SECCI√ìN SELECCIONADA -->
  <div class="ejercicios-seccion-menu" *ngIf="vistaActual === 'ejercicios' && seccionActiva">
    <!-- ‚úÖ NUEVO HEADER CON IMAGEN DE FONDO (SIN STATS NI BARRA) -->
    <div class="header-ejercicios-nuevo">
      <button class="btn-back-nuevo" (click)="volverASecciones()">
        ‚Üê Volver a Secciones
      </button>
      
      <!-- Imagen de fondo con overlay -->
      <div class="header-background" 
           [style.background-image]="'url(' + seccionActiva.imagen + ')'">
        <div class="header-overlay"></div>
        
        <!-- Contenido del header (SOLO T√çTULO Y DESCRIPCI√ìN) -->
        <div class="header-content">
          <h2 class="seccion-titulo-nuevo">{{seccionActiva.nombre}}</h2>
          <p class="seccion-descripcion-nuevo">{{seccionActiva.descripcion}}</p>
        </div>
      </div>
    </div>

    <div class="ejercicios-grid">
      <div 
        class="ejercicio-card" 
        *ngFor="let ejercicio of seccionActiva.ejercicios"
        (click)="iniciarEjercicio(ejercicio)"
        [style.border-color]="ejercicio.color">
        
        <!-- ‚úÖ IMAGEN EN VEZ DE EMOJI -->
        <div class="ejercicio-imagen-container">
          <img 
            [src]="ejercicio.imagen" 
            [alt]="ejercicio.nombre"
            class="ejercicio-imagen"
            [style.border-color]="ejercicio.color">
        </div>
        
        <h3>{{ejercicio.nombre}}</h3>
        <p>{{ejercicio.descripcion}}</p>
        
        <div class="ejercicio-duracion">
          <span class="duracion-icono">‚è±Ô∏è</span>
          <span>{{ejercicio.duracion}}s</span>
        </div>
        
        <!-- ‚úÖ SOLO MOSTRAR CHECKMARK SI EST√Å COMPLETADO -->
        <div class="ejercicio-completado" *ngIf="resultados[ejercicio.id] && resultados[ejercicio.id].completado">
          <span class="checkmark">‚úÖ</span>
          <span class="texto-completado">Completado</span>
        </div>
        
        <div class="btn-iniciar" 
             *ngIf="!resultados[ejercicio.id] || !resultados[ejercicio.id].completado"
             [style.background]="'linear-gradient(135deg, ' + ejercicio.color + ', ' + ejercicio.color + 'dd)'">
          <span>¬°Comenzar!</span>
        </div>
      </div>
    </div>
  </div>

  <!-- üéØ VISTA 3: EJERCICIO ACTIVO - ‚úÖ CORREGIDO -->
  <div class="ejercicio-activo" *ngIf="vistaActual === 'activo' && ejercicioActivo">
    <div class="ejercicio-header">
      <div class="header-info">
        <div class="breadcrumb">
          <span (click)="volverASecciones()" class="breadcrumb-link">Secciones</span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span (click)="volverAlMenu()" class="breadcrumb-link">{{seccionActiva?.nombre}}</span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-current">{{ejercicioActivo.nombre}}</span>
        </div>
        
        <h2 [style.color]="ejercicioActivo.color">
          {{ejercicioActivo.icono}} {{ejercicioActivo.nombre}}
        </h2>
      </div>
      
      <div class="ejercicio-info" *ngIf="isRecording">
        <div class="tiempo-restante">
          ‚è±Ô∏è {{tiempoRestante}}s
        </div>
      </div>
    </div>

    <div class="video-section">
      <!-- ‚úÖ CONTENEDOR CORREGIDO -->
      <div class="video-container">
        <!-- ‚úÖ Video sin width/height fijos -->
        <video #videoElement class="input-video" playsinline autoplay muted></video>
        
        <!-- ‚úÖ Canvas sin width/height fijos (se ajustan por JS) -->
        <canvas #canvasElement class="output-canvas"></canvas>
        
        <!-- Feedback Visual -->
        <div class="feedback-overlay" *ngIf="isRecording">
          <div class="feedback-message" 
               [class.success]="feedbackTipo === 'success'"
               [class.warning]="feedbackTipo === 'warning'"
               [class.error]="feedbackTipo === 'error'">
            {{mensajeFeedback}}
          </div>
          
          <!-- Indicador de Progreso -->
          <div class="progreso-container">
            <div class="progreso-bar" 
                 [style.width.%]="progresoEjercicio"
                 [style.background-color]="ejercicioActivo?.color">
            </div>
          </div>
        </div>
      </div>

      <div class="instrucciones">
        <p>{{ejercicioActivo.instrucciones}}</p>
      </div>
    </div>

    <div class="controles-ejercicio">
      <button (click)="detenerEjercicio()" class="btn-detener" *ngIf="isRecording">
        ‚èπÔ∏è Detener
      </button>
      <button (click)="reiniciarEjercicio()" class="btn-reiniciar" *ngIf="isRecording">
        üîÑ Reiniciar
      </button>
      <button (click)="volverAlMenu()" class="btn-back-ejercicios" *ngIf="!isRecording">
        ‚Üê Volver a {{seccionActiva?.nombre}}
      </button>
      
      <!-- Mensaje de carga -->
      <div *ngIf="!isRecording" class="loading-message">
        üé• Iniciando c√°mara... Por favor espera
      </div>
    </div>
  </div>

  <!-- üéâ VISTA 4: PANTALLA DE RESULTADOS MEJORADA -->
  <div class="resultados-screen" *ngIf="vistaActual === 'resultados' || mostrarResultados">
    <div class="resultado-card-nuevo">
      <!-- Badge de secci√≥n arriba -->
      <div class="resultado-seccion-badge" *ngIf="seccionActiva" [style.background-color]="seccionActiva.color">
        {{seccionActiva.nombre}}
      </div>
      
      <!-- T√≠tulo principal -->
      <div class="resultado-titulo-principal">
        <h2 class="resultado-titulo">¬°Ejercicio Completado!</h2>
      </div>
      
      <!-- Mensaje motivacional DIN√ÅMICO seg√∫n puntuaci√≥n -->
      <div class="resultado-contenido">
        <!-- ‚úÖ Mensaje si puntuaci√≥n >= 70% -->
        <div *ngIf="ultimoResultado && ultimoResultado.puntuacion >= 70">
          <h3 class="resultado-mensaje-grande excelente">¬°EXCELENTE!</h3>
          <p class="resultado-mensaje-motivacional">
            ¬°Lo hiciste muy bien! Cada vez que practicas te vuelves m√°s fuerte. ¬°Sigue as√≠ campe√≥n!
          </p>
        </div>
        
        <!-- ‚ö†Ô∏è Mensaje si puntuaci√≥n entre 40% y 69% -->
        <div *ngIf="ultimoResultado && ultimoResultado.puntuacion >= 40 && ultimoResultado.puntuacion < 70">
          <h3 class="resultado-mensaje-grande bien">¬°BUEN INTENTO!</h3>
          <p class="resultado-mensaje-motivacional">
            Vas por buen camino. Sigue practicando y mejorar√°s cada d√≠a m√°s. ¬°No te rindas!
          </p>
        </div>
        
        <!-- ‚ùå Mensaje si puntuaci√≥n < 40% -->
        <div *ngIf="ultimoResultado && ultimoResultado.puntuacion < 40">
          <h3 class="resultado-mensaje-grande intentalo">¬°INT√âNTALO DE NUEVO!</h3>
          <p class="resultado-mensaje-motivacional">
            Parece que no pudimos detectar el ejercicio correctamente. Aseg√∫rate de estar bien iluminado y de hacer el movimiento claramente. ¬°T√∫ puedes!
          </p>
        </div>
        
        <!-- Si no hay resultado (no deber√≠a pasar) -->
        <div *ngIf="!ultimoResultado">
          <h3 class="resultado-mensaje-grande">¬°COMPLETADO!</h3>
          <p class="resultado-mensaje-motivacional">
            Has terminado el ejercicio. ¬°Sigue practicando!
          </p>
        </div>
      </div>
      
      <!-- Botones de acci√≥n mejorados -->
      <div class="resultado-acciones-nuevo">
        <button (click)="repetirEjercicio()" class="btn-resultado btn-repetir-nuevo">
          Repetir Ejercicio
        </button>
        <button (click)="volverAlMenu()" class="btn-resultado btn-volver-nuevo">
          Volver a {{seccionActiva?.nombre}}
        </button>
        <button (click)="volverASecciones()" class="btn-resultado btn-secciones-nuevo" *ngIf="seccionActiva">
          Otras Secciones
        </button>
      </div>
    </div>
  </div>
  
</div>